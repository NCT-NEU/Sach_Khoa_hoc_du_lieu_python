
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>8. Làm sạch và chuẩn bị dữ liệu &#8212; Khoa học dữ liệu trong Kinh tế và Kinh doanh (Sử dụng ngôn ngữ Python)</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapters/chapter8-prepare';</script>
    <link rel="canonical" href="/Sach_Khoa_hoc_du_lieu_python/chapters/chapter8-prepare.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. Sắp xếp và biến đổi dữ liệu" href="chapter9-transform.html" />
    <link rel="prev" title="7. Nhập và lưu trữ dữ liệu" href="chapter7-Import-data.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Khoa học dữ liệu trong Kinh tế và Kinh doanh (Sử dụng ngôn ngữ Python) - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Khoa học dữ liệu trong Kinh tế và Kinh doanh (Sử dụng ngôn ngữ Python) - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    Khoa học dữ liệu trong Kinh tế và Kinh doanh
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Danh sách chương</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gioi-thieu-ve-khoa-hoc-du-lieu.html">1. Các khái niệm cơ bản trong khoa học dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="nguyen-ly-phan-tich-du-lieu.html">2. Nguyên lý phân tích dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="khung-phuong-phap-xay-dung-mo-hinh.html">3. Tổng quan về xây dựng mô hình trên dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter4-basics.html">4. Python cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter5-Numpy.html">5. Kiến thức cơ bản về NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter6-pandas.html">6. Giới thiệu về pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter7-Import-data.html">7. Nhập và lưu trữ dữ liệu</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">8. Làm sạch và chuẩn bị dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter9-transform.html">9. Sắp xếp và biến đổi dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter10-visualization.html">10. Trực quan hóa dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter12-Supervised.html">11. Các mô hình học máy có giám sát</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bài tập thực hành</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../practice-exercises/100_bai_tap_python_day_du.html">Python cơ bản</a></li>
<li class="toctree-l1"><a class="reference internal" href="../practice-exercises/50_bai_tap_numpy.html">Bài tập NumPy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../practice-exercises/30_bai_tap_pandas.html">Bài tập trực quan hóa dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../practice-exercises/Pandas_Exercise.html">Thực hành nhập liệu từ các nguồn khác nhau</a></li>





<li class="toctree-l1"><a class="reference internal" href="../practice-exercises/50_bai_tap_tien_xu_ly_du_lieu.html">Tiền xử lý dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../practice-exercises/50_bai_tap_matplotlib_seaborn.html">Thực hành trực quan hóa dữ liệu</a></li>
<li class="toctree-l1"><a class="reference internal" href="../practice-exercises/50_bai_tap_linear_softmax_models.html">Mô hình tuyến tính</a></li>
<li class="toctree-l1"><a class="reference internal" href="../practice-exercises/50_bai_tap_cay_rung_boosting.html">Cây quyết định và tập hợp cây quyết định</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/NCT-NEU/Sach_Khoa_hoc_du_lieu_python/main?urlpath=tree/chapters/chapter8-prepare.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/NCT-NEU/Sach_Khoa_hoc_du_lieu_python/blob/main/chapters/chapter8-prepare.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/NCT-NEU/Sach_Khoa_hoc_du_lieu_python" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/NCT-NEU/Sach_Khoa_hoc_du_lieu_python/issues/new?title=Issue%20on%20page%20%2Fchapters/chapter8-prepare.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapters/chapter8-prepare.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Làm sạch và chuẩn bị dữ liệu</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xu-ly-du-lieu-khong-quan-sat-duoc">8.1. Xử lý dữ liệu không quan sát được</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loc-bo-du-lieu-bi-thieu">8.1.1. Lọc bỏ dữ liệu bị thiếu</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dien-vao-du-lieu-bi-thieu">8.1.2. Điền vào dữ liệu bị thiếu</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chuyen-doi-du-lieu">8.2. Chuyển đổi Dữ Liệu</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loai-bo-cac-gia-tri-trung-lap">8.2.1. Loại bỏ các giá trị trùng lặp</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chuyen-doi-du-lieu-bang-ham-hoac-mapping">8.2.2. Chuyển đổi dữ liệu bằng hàm hoặc mapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thay-the-cac-gia-tri">8.2.3. Thay thế các giá trị</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#doi-ten-chi-so-hang-va-cot">8.2.4. Đổi tên chỉ số hàng và cột</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#roi-rac-hoa-va-phan-nhom">8.2.5. Rời rạc hóa và phân nhóm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phat-hien-va-xu-ly-cac-gia-tri-ngoai-lai">8.2.6. Phát hiện và xử lý các giá trị ngoại lai</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tinh-toan-bien-chi-bao">8.2.7. Tính toán biến chỉ báo</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#thao-tac-tren-chuoi-ky-tu">8.3. Thao tác trên chuỗi ký tự</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cac-phuong-thuc-doi-tuong-chuoi-ky-tu-tich-hop-san-cua-python">8.3.1. Các phương thức đối tượng chuỗi ký tự tích hợp sẵn của Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bieu-thuc-chinh-quy">8.3.2. Biểu thức chính quy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#du-lieu-kieu-phan-loai">8.4. Dữ liệu kiểu phân loại</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#du-lieu-kieu-phan-loai-la-gi">8.4.1. Dữ liệu kiểu phân loại là gì?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kieu-phan-loai-trong-pandas">8.4.2. Kiểu phân loại trong pandas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tinh-toan-voi-du-lieu-phan-loai">8.4.3. Tính toán với dữ liệu phân loại</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-luong-hieu-suat-khi-su-dung-du-lieu-phan-loai">8.4.4. Đo lường hiệu suất khi sử dụng dữ liệu phân loại</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phuong-thuc-phan-loai">8.4.5. Phương thức phân loại</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tao-bien-gia-de-lap-mo-hinh">8.4.5.1. Tạo biến giả để lập mô hình</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="" src="../_images/banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lam-sach-va-chuan-bi-du-lieu">
<h1><span class="section-number">8. </span>Làm sạch và chuẩn bị dữ liệu<a class="headerlink" href="#lam-sach-va-chuan-bi-du-lieu" title="Link to this heading">#</a></h1>
<hr><p>Trong quá trình phân tích và xây dựng mô hình dữ liệu, một phần đáng kể thời gian thường được dành cho công việc chuẩn bị dữ liệu, bao gồm: thu thập, làm sạch, chuyển đổi và cấu trúc lại dữ liệu. Nhiều nghiên cứu thực nghiệm đã ghi nhận rằng các tác vụ này có thể chiếm tới 80% hoặc hơn tổng thời gian làm việc của một nhà phân tích dữ liệu.</p>
<p>Một trong những thách thức phổ biến là dữ liệu được lưu trữ dưới các định dạng không phù hợp với yêu cầu của bài toán phân tích cụ thể. Do đó, các nhà phân tích thường phải thực hiện các thao tác chuyển đổi linh hoạt giữa các cấu trúc dữ liệu, sử dụng những ngôn ngữ lập trình như Python, R, hoặc Java, cũng như các công cụ dòng lệnh truyền thống trong môi trường Unix.</p>
<p>Tuy nhiên, sự kết hợp giữa thư viện <code class="docutils literal notranslate"><span class="pre">pandas</span></code> và các khả năng tích hợp sẵn của ngôn ngữ Python đã cung cấp một bộ công cụ thao tác dữ liệu có hiệu quả cao, có thể mở rộng, giúp giải quyết nhanh chóng hầu hết các nhu cầu xử lý dữ liệu phổ biến trong thực tiễn nghiên cứu và ứng dụng.</p>
<p>Trong trường hợp người dùng phát hiện một thao tác xử lý dữ liệu chưa được đề cập trong tài liệu này hoặc chưa được hỗ trợ trong pandas, việc chia sẻ trường hợp sử dụng cụ thể lên cộng đồng phát triển pandas trên GitHub hoặc các danh sách thư tín Python là rất được khuyến khích. Trên thực tế, nhiều cải tiến trong thiết kế và triển khai pandas đã trực tiếp xuất phát từ các yêu cầu thực tế như vậy.</p>
<p>Chương này sẽ tập trung trình bày các công cụ hỗ trợ xử lý dữ liệu thiếu, dữ liệu trùng lặp, thao tác trên chuỗi ký tự, cùng với một số phép biến đổi dữ liệu phục vụ mục tiêu phân tích. Trong chương kế tiếp, chúng ta sẽ tiếp tục tìm hiểu về các kỹ thuật kết hợp và tái tổ chức tập dữ liệu, qua đó hỗ trợ cho quá trình phân tích và trực quan hóa dữ liệu một cách hiệu quả hơn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="n">PREVIOUS_MAX_ROWS</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span> <span class="c1"># để ví dụ có thể lặp lại</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;figure&quot;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">suppress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="xu-ly-du-lieu-khong-quan-sat-duoc">
<h2><span class="section-number">8.1. </span>Xử lý dữ liệu không quan sát được<a class="headerlink" href="#xu-ly-du-lieu-khong-quan-sat-duoc" title="Link to this heading">#</a></h2>
<p>Dữ liệu không quan sát được (missing data) thường xuyên xuất hiện trong nhiều ứng dụng phân tích dữ liệu. Một trong những mục tiêu của <code class="docutils literal notranslate"><span class="pre">pandas</span></code> là làm cho việc xử lý dữ liệu không quan sát được trở nên dễ dàng nhất có thể. Ví dụ, tất cả các thống kê mô tả trên các đối tượng của <code class="docutils literal notranslate"><span class="pre">pandas</span></code> đều loại trừ dữ liệu này theo mặc định.</p>
<p>Cách biểu diễn dữ liệu không quan sát được trong các đối tượng <code class="docutils literal notranslate"><span class="pre">pandas</span></code> còn nhiều vấn đề, nhưng cũng đủ cho hầu hết các mục đích sử dụng trong thực tế. Đối với dữ liệu có kiểu <code class="docutils literal notranslate"><span class="pre">float64</span></code>, pandas sử dụng giá trị dấu phẩy động <code class="docutils literal notranslate"><span class="pre">NaN</span></code> (Not a Number) để biểu diễn dữ liệu bị thiếu.</p>
<p>Chúng ta gọi đây là một <em>giá trị sentinel</em>: khi có mặt, nó chỉ ra một giá trị bị không quan sát được (hoặc null):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">float_data</span>
<span class="c1"># Out[15]: </span>
<span class="c1"># 0    1.2</span>
<span class="c1"># 1   -3.5</span>
<span class="c1"># 2    NaN</span>
<span class="c1"># 3    0.0</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1.2
1   -3.5
2    NaN
3    0.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Phương thức <code class="docutils literal notranslate"><span class="pre">isna</span></code> trả về một mảng kiểu logical với giá trị <code class="docutils literal notranslate"><span class="pre">True</span></code> ở những nơi giá trị là không quan sát được:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float_data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
<span class="c1"># Out[16]: </span>
<span class="c1"># 0    False</span>
<span class="c1"># 1    False</span>
<span class="c1"># 2     True</span>
<span class="c1"># 3    False</span>
<span class="c1"># dtype: bool</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    False
1    False
2     True
3    False
dtype: bool
</pre></div>
</div>
</div>
</div>
<p>Trong pandas cũng áp dụng một quy ước được sử dụng trong ngôn ngữ lập trình R bằng cách gọi dữ liệu không quan sát được là <code class="docutils literal notranslate"><span class="pre">NA</span></code>, viết tắt của <em>not available</em>. Trong các ứng dụng thống kê, dữ liệu <code class="docutils literal notranslate"><span class="pre">NA</span></code> có thể là dữ liệu không tồn tại hoặc tồn tại nhưng không được quan sát (ví dụ, do các vấn đề trong quá trình thu thập dữ liệu). Khi dọn dẹp dữ liệu để phân tích, việc phân tích chính dữ liệu <code class="docutils literal notranslate"><span class="pre">NA</span></code> thường rất quan trọng để xác định các vấn đề thu thập dữ liệu hoặc các sai lệch tiềm ẩn trong dữ liệu do dữ liệu bị thiếu gây ra.</p>
<p>Giá trị <code class="docutils literal notranslate"><span class="pre">None</span></code> tích hợp sẵn của Python cũng được coi là <code class="docutils literal notranslate"><span class="pre">NA</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">string_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s2">&quot;aardvark&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;avocado&quot;</span><span class="p">])</span>
<span class="n">string_data</span>
<span class="c1"># Out[18]:</span>
<span class="c1"># 0    aardvark</span>
<span class="c1"># 1         NaN</span>
<span class="c1"># 2        None</span>
<span class="c1"># 3     avocado</span>
<span class="c1"># dtype: object</span>

<span class="n">string_data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
<span class="c1"># Out[19]:</span>
<span class="c1"># 0    False</span>
<span class="c1"># 1     True</span>
<span class="c1"># 2     True</span>
<span class="c1"># 3    False</span>
<span class="c1"># dtype: bool</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    False
1     True
2     True
3    False
dtype: bool
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">float_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="n">float_data</span>
<span class="c1"># Out[21]:</span>
<span class="c1"># 0    1.0</span>
<span class="c1"># 1    2.0</span>
<span class="c1"># 2    NaN</span>
<span class="c1"># dtype: float64</span>

<span class="n">float_data</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>
<span class="c1"># Out[22]:</span>
<span class="c1"># 0    False</span>
<span class="c1"># 1    False</span>
<span class="c1"># 2     True</span>
<span class="c1"># dtype: bool</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    False
1    False
2     True
dtype: bool
</pre></div>
</div>
</div>
</div>
<p>Thư viện <code class="docutils literal notranslate"><span class="pre">pandas</span></code> đã cố gắng làm cho việc xử lý dữ liệu không quan sát được nhất quán giữa các kiểu dữ liệu. Xem Bảng … để biết danh sách một số hàm liên quan đến xử lý dữ liệu không quan sát được.</p>
<p><strong>Bảng …: Các phương thức xử lý NA</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Phương thức</p></th>
<th class="head"><p>Mô tả</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">dropna</span></code></p></td>
<td><p>Lọc các chỉ số dựa trên việc các giá trị cho chỉ số có dữ liệu bị thiếu hay không</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">fillna</span></code></p></td>
<td><p>Điền vào dữ liệu <code class="docutils literal notranslate"><span class="pre">NA</span></code> bằng một giá trị nào đó hoặc sử dụng một phương pháp nội suy như <code class="docutils literal notranslate"><span class="pre">&quot;ffill&quot;</span></code> hoặc <code class="docutils literal notranslate"><span class="pre">&quot;bfill&quot;</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">isna</span></code></p></td>
<td><p>Trả về các giá trị boolean cho biết giá trị nào là <code class="docutils literal notranslate"><span class="pre">NA</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">notna</span></code></p></td>
<td><p>Phủ định của <code class="docutils literal notranslate"><span class="pre">isna</span></code>, trả về <code class="docutils literal notranslate"><span class="pre">True</span></code> cho các giá trị không phải NA và <code class="docutils literal notranslate"><span class="pre">False</span></code> cho các giá trị NA.</p></td>
</tr>
</tbody>
</table>
</div>
<section id="loc-bo-du-lieu-bi-thieu">
<h3><span class="section-number">8.1.1. </span>Lọc bỏ dữ liệu bị thiếu<a class="headerlink" href="#loc-bo-du-lieu-bi-thieu" title="Link to this heading">#</a></h3>
<p>Có nhiều cách để lọc bỏ dữ liệu bị thiếu. Mặc dù bạn luôn có thể tự làm điều đó bằng cách sử dụng <code class="docutils literal notranslate"><span class="pre">pandas.notna</span></code> và lọc dữ liệu bằng chỉ số kiểu logical. Ngoài ra bạn có thể dùng phương thức <code class="docutils literal notranslate"><span class="pre">dropna</span></code> như đã mô tả ở trên:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="c1"># Out[24]:</span>
<span class="c1"># 0    1.0</span>
<span class="c1"># 2    3.5</span>
<span class="c1"># 4    7.0</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1.0
2    3.5
4    7.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Điều này tương đương với:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
<span class="c1"># Out[25]:</span>
<span class="c1"># 0    1.0</span>
<span class="c1"># 2    3.5</span>
<span class="c1"># 4    7.0</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1.0
2    3.5
4    7.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Với các đối tượng DataFrame, có nhiều cách khác nhau để loại bỏ dữ liệu không quan sát được. Bạn có thể muốn loại bỏ các hàng hoặc cột hoàn toàn là <code class="docutils literal notranslate"><span class="pre">NA</span></code>, hoặc chỉ những hàng hoặc cột chứa bất kỳ <code class="docutils literal notranslate"><span class="pre">NA</span></code> nào. <code class="docutils literal notranslate"><span class="pre">dropna</span></code> theo mặc định sẽ loại bỏ bất kỳ hàng nào chứa một giá trị không quan sát được:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">3.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">3.</span><span class="p">]])</span>
<span class="n">data</span>
<span class="c1"># Out[27]:</span>
<span class="c1">#      0    1    2</span>
<span class="c1"># 0  1.0  6.5  3.0</span>
<span class="c1"># 1  1.0  NaN  NaN</span>
<span class="c1"># 2  NaN  NaN  NaN</span>
<span class="c1"># 3  NaN  6.5  3.0</span>

<span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="c1"># Out[28]:</span>
<span class="c1">#      0    1    2</span>
<span class="c1"># 0  1.0  6.5  3.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>6.5</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Sử dụng tham số <code class="docutils literal notranslate"><span class="pre">how=&quot;all&quot;</span></code> sẽ chỉ loại bỏ các hàng mà tất cả các giá trị đều là <code class="docutils literal notranslate"><span class="pre">NA</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="c1"># Out[29]:</span>
<span class="c1">#      0    1    2</span>
<span class="c1"># 0  1.0  6.5  3.0</span>
<span class="c1"># 1  1.0  NaN  NaN</span>
<span class="c1"># 3  NaN  6.5  3.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>6.5</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>6.5</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Hãy lưu ý rằng các hàm này trả về các đối tượng mới theo mặc định và không sửa đổi nội dung của đối tượng ban đầu.</p>
<p>Để loại bỏ các cột theo cách tương tự, hãy sử dụng tham số <code class="docutils literal notranslate"><span class="pre">axis=&quot;columns&quot;</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">data</span>
<span class="c1"># Out[31]:</span>
<span class="c1">#      0    1    2   4</span>
<span class="c1"># 0  1.0  6.5  3.0 NaN</span>
<span class="c1"># 1  1.0  NaN  NaN NaN</span>
<span class="c1"># 2  NaN  NaN  NaN NaN</span>
<span class="c1"># 3  NaN  6.5  3.0 NaN</span>

<span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="c1"># Out[32]:</span>
<span class="c1">#      0    1    2</span>
<span class="c1"># 0  1.0  6.5  3.0</span>
<span class="c1"># 1  1.0  NaN  NaN</span>
<span class="c1"># 2  NaN  NaN  NaN</span>
<span class="c1"># 3  NaN  6.5  3.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>6.5</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>6.5</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Giả sử bạn muốn giữ lại chỉ những hàng chứa tối đa một số lượng <code class="docutils literal notranslate"><span class="pre">NA</span></code> nhất định. Bạn có thể chỉ ra điều này bằng tham số <code class="docutils literal notranslate"><span class="pre">thresh</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">df</span>
<span class="c1"># Out[36]:</span>
<span class="c1">#           0         1         2</span>
<span class="c1"># 0 -0.204708       NaN       NaN</span>
<span class="c1"># 1 -0.555730       NaN       NaN</span>
<span class="c1"># 2  0.092908       NaN  0.769023</span>
<span class="c1"># 3  1.246435       NaN -1.296221</span>
<span class="c1"># 4  0.274992  0.228913  1.352917</span>
<span class="c1"># 5  0.886429 -2.001637 -0.371843</span>
<span class="c1"># 6  1.669025 -0.438570 -0.539741</span>

<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="c1"># Out[37]:</span>
<span class="c1">#           0         1         2</span>
<span class="c1"># 4  0.274992  0.228913  1.352917</span>
<span class="c1"># 5  0.886429 -2.001637 -0.371843</span>
<span class="c1"># 6  1.669025 -0.438570 -0.539741</span>

<span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Out[38]:</span>
<span class="c1">#           0         1         2</span>
<span class="c1"># 2  0.092908       NaN  0.769023</span>
<span class="c1"># 3  1.246435       NaN -1.296221</span>
<span class="c1"># 4  0.274992  0.228913  1.352917</span>
<span class="c1"># 5  0.886429 -2.001637 -0.371843</span>
<span class="c1"># 6  1.669025 -0.438570 -0.539741</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>0.092908</td>
      <td>NaN</td>
      <td>0.769023</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.246435</td>
      <td>NaN</td>
      <td>-1.296221</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.274992</td>
      <td>0.228913</td>
      <td>1.352917</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.886429</td>
      <td>-2.001637</td>
      <td>-0.371843</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.669025</td>
      <td>-0.438570</td>
      <td>-0.539741</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="dien-vao-du-lieu-bi-thieu">
<h3><span class="section-number">8.1.2. </span>Điền vào dữ liệu bị thiếu<a class="headerlink" href="#dien-vao-du-lieu-bi-thieu" title="Link to this heading">#</a></h3>
<p>Thay vì lọc bỏ dữ liệu không quan sát được và có khả năng loại bỏ dữ liệu khác cùng hàng hoặc cùng cột, bạn có giải pháp là điền vào các giá trị này theo nhiều cách. Đối với hầu hết các mục đích, phương thức <code class="docutils literal notranslate"><span class="pre">fillna</span></code> là hàm chính được sử dụng. Phương pháp đơn giản nhất là gọi <code class="docutils literal notranslate"><span class="pre">fillna</span></code> với một hằng số để thay thế các giá trị <code class="docutils literal notranslate"><span class="pre">NA</span></code> bằng giá trị đó:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Out[39]:</span>
<span class="c1">#           0         1         2</span>
<span class="c1"># 0 -0.204708  0.000000  0.000000</span>
<span class="c1"># 1 -0.555730  0.000000  0.000000</span>
<span class="c1"># 2  0.092908  0.000000  0.769023</span>
<span class="c1"># 3  1.246435  0.000000 -1.296221</span>
<span class="c1"># 4  0.274992  0.228913  1.352917</span>
<span class="c1"># 5  0.886429 -2.001637 -0.371843</span>
<span class="c1"># 6  1.669025 -0.438570 -0.539741</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.204708</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.555730</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.092908</td>
      <td>0.000000</td>
      <td>0.769023</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.246435</td>
      <td>0.000000</td>
      <td>-1.296221</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.274992</td>
      <td>0.228913</td>
      <td>1.352917</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.886429</td>
      <td>-2.001637</td>
      <td>-0.371843</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.669025</td>
      <td>-0.438570</td>
      <td>-0.539741</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Gọi <code class="docutils literal notranslate"><span class="pre">fillna</span></code> với tham số là một dictionary, bạn có thể điền các giá trị khác nhau cho mỗi cột:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="c1"># Out[40]:</span>
<span class="c1">#           0         1         2</span>
<span class="c1"># 0 -0.204708  0.500000  0.000000</span>
<span class="c1"># 1 -0.555730  0.500000  0.000000</span>
<span class="c1"># 2  0.092908  0.500000  0.769023</span>
<span class="c1"># 3  1.246435  0.500000 -1.296221</span>
<span class="c1"># 4  0.274992  0.228913  1.352917</span>
<span class="c1"># 5  0.886429 -2.001637 -0.371843</span>
<span class="c1"># 6  1.669025 -0.438570 -0.539741</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.204708</td>
      <td>0.500000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.555730</td>
      <td>0.500000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.092908</td>
      <td>0.500000</td>
      <td>0.769023</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.246435</td>
      <td>0.500000</td>
      <td>-1.296221</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.274992</td>
      <td>0.228913</td>
      <td>1.352917</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.886429</td>
      <td>-2.001637</td>
      <td>-0.371843</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.669025</td>
      <td>-0.438570</td>
      <td>-0.539741</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Các phương pháp nội suy tương tự có sẵn cho việc sắp xếp lại (xem Bảng 5.3) có thể được sử dụng với <code class="docutils literal notranslate"><span class="pre">fillna</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">4</span><span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">df</span>
<span class="c1"># Out[44]:</span>
<span class="c1">#           0         1         2</span>
<span class="c1"># 0  0.476985  3.248944 -1.021228</span>
<span class="c1"># 1 -0.577087  0.124121  0.302614</span>
<span class="c1"># 2  0.523772       NaN  1.343810</span>
<span class="c1"># 3 -0.713544       NaN -2.370232</span>
<span class="c1"># 4 -1.860761       NaN       NaN</span>
<span class="c1"># 5 -1.265934       NaN       NaN</span>

<span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">)</span>
<span class="c1"># Out[45]:</span>
<span class="c1">#           0         1         2</span>
<span class="c1"># 0  0.476985  3.248944 -1.021228</span>
<span class="c1"># 1 -0.577087  0.124121  0.302614</span>
<span class="c1"># 2  0.523772  0.124121  1.343810</span>
<span class="c1"># 3 -0.713544  0.124121 -2.370232</span>
<span class="c1"># 4 -1.860761  0.124121 -2.370232</span>
<span class="c1"># 5 -1.265934  0.124121 -2.370232</span>

<span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;ffill&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Out[46]:</span>
<span class="c1">#           0         1         2</span>
<span class="c1"># 0  0.476985  3.248944 -1.021228</span>
<span class="c1"># 1 -0.577087  0.124121  0.302614</span>
<span class="c1"># 2  0.523772  0.124121  1.343810</span>
<span class="c1"># 3 -0.713544  0.124121 -2.370232</span>
<span class="c1"># 4 -1.860761       NaN -2.370232</span>
<span class="c1"># 5 -1.265934       NaN -2.370232</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.476985</td>
      <td>3.248944</td>
      <td>-1.021228</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.577087</td>
      <td>0.124121</td>
      <td>0.302614</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.523772</td>
      <td>0.124121</td>
      <td>1.343810</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.713544</td>
      <td>0.124121</td>
      <td>-2.370232</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.860761</td>
      <td>NaN</td>
      <td>-2.370232</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-1.265934</td>
      <td>NaN</td>
      <td>-2.370232</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Với <code class="docutils literal notranslate"><span class="pre">fillna</span></code>, bạn có thể làm điền dữ liệu bằng các giá trị thống kê đặc trưng như trung vị hoặc trung bình:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="n">data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="c1"># Out[48]:</span>
<span class="c1"># 0    1.000000</span>
<span class="c1"># 1    3.833333</span>
<span class="c1"># 2    3.500000</span>
<span class="c1"># 3    3.833333</span>
<span class="c1"># 4    7.000000</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1.000000
1    3.833333
2    3.500000
3    3.833333
4    7.000000
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Xem Bảng … để tham khảo về các tham số của hàm <code class="docutils literal notranslate"><span class="pre">fillna</span></code>.</p>
<p><strong>Bảng…: các tham số của hàm fillna</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Tham số</p></th>
<th class="head"><p>Mô tả</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">value</span></code></p></td>
<td><p>Giá trị vô hướng hoặc đối tượng giống dictionary được sử dụng để điền vào các giá trị bị thiếu.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">method</span></code></p></td>
<td><p>Phương pháp nội suy; một trong <code class="docutils literal notranslate"><span class="pre">&quot;bfill&quot;</span></code> (điền lùi) hoặc <code class="docutils literal notranslate"><span class="pre">&quot;ffill&quot;</span></code> (điền tiến); mặc định là <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">axis</span></code></p></td>
<td><p>Trục cần điền (<code class="docutils literal notranslate"><span class="pre">&quot;index&quot;</span></code> hoặc <code class="docutils literal notranslate"><span class="pre">&quot;columns&quot;</span></code>); mặc định là <code class="docutils literal notranslate"><span class="pre">axis=&quot;index&quot;</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">limit</span></code></p></td>
<td><p>Đối với điền tiến và lùi, số lượng tối đa các khoảng trống liên tiếp cần điền.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="chuyen-doi-du-lieu">
<h2><span class="section-number">8.2. </span>Chuyển đổi Dữ Liệu<a class="headerlink" href="#chuyen-doi-du-lieu" title="Link to this heading">#</a></h2>
<p>Cho đến nay trong chương này, chúng ta đã thảo luận về xử lý dữ liệu bị thiếu. Ngoài ra, lọc dữ liệu và làm sạch làm sạch dữ liệu cũng là các bước xử lý quan trọng khác.</p>
<section id="loai-bo-cac-gia-tri-trung-lap">
<h3><span class="section-number">8.2.1. </span>Loại bỏ các giá trị trùng lặp<a class="headerlink" href="#loai-bo-cac-gia-tri-trung-lap" title="Link to this heading">#</a></h3>
<p>Các hàng trùng lặp có thể được tìm thấy trong một DataFrame vì nhiều lý do. Đây là một ví dụ:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;k1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;two&quot;</span><span class="p">],</span>
                     <span class="s2">&quot;k2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]})</span>
<span class="n">data</span>
<span class="c1"># Out[50]:</span>
<span class="c1">#      k1  k2</span>
<span class="c1"># 0   one   1</span>
<span class="c1"># 1   two   1</span>
<span class="c1"># 2   one   2</span>
<span class="c1"># 3   two   3</span>
<span class="c1"># 4   one   3</span>
<span class="c1"># 5   two   4</span>
<span class="c1"># 6   two   4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>k1</th>
      <th>k2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>one</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>two</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>one</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>two</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>one</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>two</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>two</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Phương thức <code class="docutils literal notranslate"><span class="pre">duplicated</span></code> của DataFrame trả về một mảng kiểu logical cho biết liệu mỗi hàng có phải là một bản sao, nghĩa là các giá trị của nó hoàn toàn bằng với các giá trị trong một hàng trước đó, hay không:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span>
<span class="c1"># Out[51]:</span>
<span class="c1"># 0    False</span>
<span class="c1"># 1    False</span>
<span class="c1"># 2    False</span>
<span class="c1"># 3    False</span>
<span class="c1"># 4    False</span>
<span class="c1"># 5    False</span>
<span class="c1"># 6     True</span>
<span class="c1"># dtype: bool</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    False
1    False
2    False
3    False
4    False
5    False
6     True
dtype: bool
</pre></div>
</div>
</div>
</div>
<p>Phương thức <code class="docutils literal notranslate"><span class="pre">drop_duplicates</span></code> trả về một DataFrame với các hàng mà mảng <code class="docutils literal notranslate"><span class="pre">duplicated</span></code> là <code class="docutils literal notranslate"><span class="pre">False</span></code> được lọc bỏ:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="c1"># Out[52]:</span>
<span class="c1">#      k1  k2</span>
<span class="c1"># 0   one   1</span>
<span class="c1"># 1   two   1</span>
<span class="c1"># 2   one   2</span>
<span class="c1"># 3   two   3</span>
<span class="c1"># 4   one   3</span>
<span class="c1"># 5   two   4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>k1</th>
      <th>k2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>one</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>two</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>one</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>two</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>one</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>two</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Cả hai phương thức này theo mặc định xem xét tất cả các cột. Tuy nhiên, bạn cũng có thể chỉ định bất kỳ tập hợp con nào của các cột để phát hiện ra các giá trị bị trùng lặp. Giả sử chúng ta có một cột giá trị bổ sung và muốn lọc các bản sao chỉ dựa trên cột <code class="docutils literal notranslate"><span class="pre">&quot;k1&quot;</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;v1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">data</span>
<span class="c1"># Out[54]:</span>
<span class="c1">#      k1  k2  v1</span>
<span class="c1"># 0   one   1   0</span>
<span class="c1"># 1   two   1   1</span>
<span class="c1"># 2   one   2   2</span>
<span class="c1"># 3   two   3   3</span>
<span class="c1"># 4   one   3   4</span>
<span class="c1"># 5   two   4   5</span>
<span class="c1"># 6   two   4   6</span>

<span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;k1&quot;</span><span class="p">])</span>
<span class="c1"># Out[55]:</span>
<span class="c1">#      k1  k2  v1</span>
<span class="c1"># 0   one   1   0</span>
<span class="c1"># 1   two   1   1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>k1</th>
      <th>k2</th>
      <th>v1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>one</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>two</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">duplicated</span></code> và <code class="docutils literal notranslate"><span class="pre">drop_duplicates</span></code> theo mặc định giữ lại tổ hợp giá trị được quan sát đầu tiên. Sử dụng tham số <code class="docutils literal notranslate"><span class="pre">keep=&quot;last&quot;</span></code> sẽ loại bỏ các hàng bị lặp xuất hiện ở phía trên:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">([</span><span class="s2">&quot;k1&quot;</span><span class="p">,</span> <span class="s2">&quot;k2&quot;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;last&quot;</span><span class="p">)</span>
<span class="c1"># Out[56]:</span>
<span class="c1">#      k1  k2  v1</span>
<span class="c1"># 0   one   1   0</span>
<span class="c1"># 1   two   1   1</span>
<span class="c1"># 2   one   2   2</span>
<span class="c1"># 3   two   3   3</span>
<span class="c1"># 4   one   3   4</span>
<span class="c1"># 6   two   4   6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>k1</th>
      <th>k2</th>
      <th>v1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>one</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>two</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>one</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>two</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>one</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>6</th>
      <td>two</td>
      <td>4</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="chuyen-doi-du-lieu-bang-ham-hoac-mapping">
<h3><span class="section-number">8.2.2. </span>Chuyển đổi dữ liệu bằng hàm hoặc mapping<a class="headerlink" href="#chuyen-doi-du-lieu-bang-ham-hoac-mapping" title="Link to this heading">#</a></h3>
<p>Đối với nhiều tập dữ liệu, bạn có thể muốn thực hiện một số chuyển đổi dựa trên các giá trị trong một mảng, Series hoặc cột trong DataFrame. Hãy xem xét dữ liệu giả định sau được thu thập về các loại thực phẩm khác nhau:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;food&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bacon&quot;</span><span class="p">,</span> <span class="s2">&quot;pulled pork&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;pastrami&quot;</span><span class="p">,</span> <span class="s2">&quot;corned beef&quot;</span><span class="p">,</span> <span class="s2">&quot;bacon&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;pastrami&quot;</span><span class="p">,</span> <span class="s2">&quot;honey ham&quot;</span><span class="p">,</span> <span class="s2">&quot;nova lox&quot;</span><span class="p">],</span>
                     <span class="s2">&quot;ounces&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span>
<span class="n">data</span>
<span class="c1"># Out[58]:</span>
<span class="c1">#           food  ounces</span>
<span class="c1"># 0        bacon     4.0</span>
<span class="c1"># 1  pulled pork     3.0</span>
<span class="c1"># 2        bacon    12.0</span>
<span class="c1"># 3     pastrami     6.0</span>
<span class="c1"># 4  corned beef     7.5</span>
<span class="c1"># 5        bacon     8.0</span>
<span class="c1"># 6     pastrami     3.0</span>
<span class="c1"># 7    honey ham     5.0</span>
<span class="c1"># 8     nova lox     6.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>food</th>
      <th>ounces</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bacon</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>pulled pork</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bacon</td>
      <td>12.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>pastrami</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>corned beef</td>
      <td>7.5</td>
    </tr>
    <tr>
      <th>5</th>
      <td>bacon</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>pastrami</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>honey ham</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>nova lox</td>
      <td>6.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Giả sử bạn muốn thêm một cột cho biết loại động vật mà mỗi loại thực phẩm đến từ đó. Cần có một mapping của từng loại thịt riêng biệt đến loại động vật:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">meat_to_animal</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;bacon&quot;</span><span class="p">:</span> <span class="s2">&quot;pig&quot;</span><span class="p">,</span>
  <span class="s2">&quot;pulled pork&quot;</span><span class="p">:</span> <span class="s2">&quot;pig&quot;</span><span class="p">,</span>
  <span class="s2">&quot;pastrami&quot;</span><span class="p">:</span> <span class="s2">&quot;cow&quot;</span><span class="p">,</span>
  <span class="s2">&quot;corned beef&quot;</span><span class="p">:</span> <span class="s2">&quot;cow&quot;</span><span class="p">,</span>
  <span class="s2">&quot;honey ham&quot;</span><span class="p">:</span> <span class="s2">&quot;pig&quot;</span><span class="p">,</span>
  <span class="s2">&quot;nova lox&quot;</span><span class="p">:</span> <span class="s2">&quot;salmon&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Phương thức <code class="docutils literal notranslate"><span class="pre">map</span></code> trên một mảng được chấp nhận như một hàm để thực hiện việc thêm một cột mới <code class="docutils literal notranslate"><span class="pre">animal</span></code> vào dữ liệu</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;animal&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;food&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">meat_to_animal</span><span class="p">)</span>
<span class="n">data</span>
<span class="c1"># Out[61]:</span>
<span class="c1">#           food  ounces  animal</span>
<span class="c1"># 0        bacon     4.0     pig</span>
<span class="c1"># 1  pulled pork     3.0     pig</span>
<span class="c1"># 2        bacon    12.0     pig</span>
<span class="c1"># 3     pastrami     6.0     cow</span>
<span class="c1"># 4  corned beef     7.5     cow</span>
<span class="c1"># 5        bacon     8.0     pig</span>
<span class="c1"># 6     pastrami     3.0     cow</span>
<span class="c1"># 7    honey ham     5.0     pig</span>
<span class="c1"># 8     nova lox     6.0  salmon</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>food</th>
      <th>ounces</th>
      <th>animal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bacon</td>
      <td>4.0</td>
      <td>pig</td>
    </tr>
    <tr>
      <th>1</th>
      <td>pulled pork</td>
      <td>3.0</td>
      <td>pig</td>
    </tr>
    <tr>
      <th>2</th>
      <td>bacon</td>
      <td>12.0</td>
      <td>pig</td>
    </tr>
    <tr>
      <th>3</th>
      <td>pastrami</td>
      <td>6.0</td>
      <td>cow</td>
    </tr>
    <tr>
      <th>4</th>
      <td>corned beef</td>
      <td>7.5</td>
      <td>cow</td>
    </tr>
    <tr>
      <th>5</th>
      <td>bacon</td>
      <td>8.0</td>
      <td>pig</td>
    </tr>
    <tr>
      <th>6</th>
      <td>pastrami</td>
      <td>3.0</td>
      <td>cow</td>
    </tr>
    <tr>
      <th>7</th>
      <td>honey ham</td>
      <td>5.0</td>
      <td>pig</td>
    </tr>
    <tr>
      <th>8</th>
      <td>nova lox</td>
      <td>6.0</td>
      <td>salmon</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Hoặc chúng ta cũng có thể định nghĩa một hàm thay cho phương thức <code class="docutils literal notranslate"><span class="pre">map</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_animal</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">meat_to_animal</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

<span class="n">data</span><span class="p">[</span><span class="s2">&quot;food&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">get_animal</span><span class="p">)</span>
<span class="c1"># Out[63]:</span>
<span class="c1"># 0       pig</span>
<span class="c1"># 1       pig</span>
<span class="c1"># 2       pig</span>
<span class="c1"># 3       cow</span>
<span class="c1"># 4       cow</span>
<span class="c1"># 5       pig</span>
<span class="c1"># 6       cow</span>
<span class="c1"># 7       pig</span>
<span class="c1"># 8    salmon</span>
<span class="c1"># Name: food, dtype: object</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       pig
1       pig
2       pig
3       cow
4       cow
5       pig
6       cow
7       pig
8    salmon
Name: food, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Nhìn chung, sử dụng <code class="docutils literal notranslate"><span class="pre">map</span></code> là một cách thuận tiện để thực hiện các phép biến đổi theo từng phần tử và các hoạt động liên quan đến làm sạch dữ liệu khác.</p>
</section>
<section id="thay-the-cac-gia-tri">
<h3><span class="section-number">8.2.3. </span>Thay thế các giá trị<a class="headerlink" href="#thay-the-cac-gia-tri" title="Link to this heading">#</a></h3>
<p>Điền vào dữ liệu bị thiếu bằng phương thức <code class="docutils literal notranslate"><span class="pre">fillna</span></code> là một trường hợp đặc biệt của việc thay thế giá trị trong trường hợp tổng quát hơn. Như chúng ta đã thấy, <code class="docutils literal notranslate"><span class="pre">map</span></code> có thể được sử dụng để sửa đổi một tập hợp con các giá trị trong một đối tượng, nhưng <code class="docutils literal notranslate"><span class="pre">replace</span></code> cung cấp một cách đơn giản và linh hoạt hơn để làm điều đó. Hãy xem xét Series này:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">999.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">999.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1000.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">])</span>
<span class="n">data</span>
<span class="c1"># Out[65]:</span>
<span class="c1"># 0       1.0</span>
<span class="c1"># 1    -999.0</span>
<span class="c1"># 2       2.0</span>
<span class="c1"># 3    -999.0</span>
<span class="c1"># 4   -1000.0</span>
<span class="c1"># 5       3.0</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       1.0
1    -999.0
2       2.0
3    -999.0
4   -1000.0
5       3.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Giá trị <code class="docutils literal notranslate"><span class="pre">-999</span></code> có thể là giá trị sentinel cho dữ liệu không quan sát được. Để thay thế những giá trị này bằng các giá trị <code class="docutils literal notranslate"><span class="pre">NA</span></code> mà pandas hiểu, chúng ta có thể sử dụng <code class="docutils literal notranslate"><span class="pre">replace</span></code>, tạo ra một Series mới:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="c1"># Out[66]:</span>
<span class="c1"># 0       1.0</span>
<span class="c1"># 1       NaN</span>
<span class="c1"># 2       2.0</span>
<span class="c1"># 3       NaN</span>
<span class="c1"># 4   -1000.0</span>
<span class="c1"># 5       3.0</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0       1.0
1       NaN
2       2.0
3       NaN
4   -1000.0
5       3.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Nếu bạn muốn thay thế nhiều giá trị cùng một lúc, bạn thay vào một danh sách và sau đó là giá trị thay thế:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="o">-</span><span class="mi">999</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
<span class="c1"># Out[67]:</span>
<span class="c1"># 0    1.0</span>
<span class="c1"># 1    NaN</span>
<span class="c1"># 2    2.0</span>
<span class="c1"># 3    NaN</span>
<span class="c1"># 4    NaN</span>
<span class="c1"># 5    3.0</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1.0
1    NaN
2    2.0
3    NaN
4    NaN
5    3.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Để sử dụng một giá trị thay thế khác nhau cho mỗi giá trị, hãy sử dụng một danh sách các giá trị thay thế:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="o">-</span><span class="mi">999</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="c1"># Out[68]:</span>
<span class="c1"># 0    1.0</span>
<span class="c1"># 1    NaN</span>
<span class="c1"># 2    2.0</span>
<span class="c1"># 3    NaN</span>
<span class="c1"># 4    0.0</span>
<span class="c1"># 5    3.0</span>
<span class="c1"># dtype: float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    1.0
1    NaN
2    2.0
3    NaN
4    0.0
5    3.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p><strong>Lưu ý</strong>: Phương thức <code class="docutils literal notranslate"><span class="pre">data.replace</span></code> khác với <code class="docutils literal notranslate"><span class="pre">data.str.replace</span></code>, phương thức này thực hiện thay thế chuỗi theo từng phần tử. Chúng ta sẽ xem xét các phương thức chuỗi này trên Series sau trong chương.</p>
</div></blockquote>
</section>
<section id="doi-ten-chi-so-hang-va-cot">
<h3><span class="section-number">8.2.4. </span>Đổi tên chỉ số hàng và cột<a class="headerlink" href="#doi-ten-chi-so-hang-va-cot" title="Link to this heading">#</a></h3>
<p>Giống như các giá trị trong một <code class="docutils literal notranslate"><span class="pre">Series</span></code>, các tên hàng và tên cột trong một <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> có thể được chuyển đổi tương tự bằng một hàm hoặc mapping để tạo ra các chỉ số mới. Bạn cũng có thể sửa đổi các chỉ số mà không cần tạo ra một cấu trúc dữ liệu mới. Đây là một ví dụ đơn giản:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Ohio&quot;</span><span class="p">,</span> <span class="s2">&quot;Colorado&quot;</span><span class="p">,</span> <span class="s2">&quot;New York&quot;</span><span class="p">],</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;one&quot;</span><span class="p">,</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="s2">&quot;three&quot;</span><span class="p">,</span> <span class="s2">&quot;four&quot;</span><span class="p">])</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Ohio</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Colorado</th>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>New York</th>
      <td>8</td>
      <td>9</td>
      <td>10</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Giống như một Series, chỉ số của trục có một phương thức <code class="docutils literal notranslate"><span class="pre">map</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

<span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
<span class="c1"># Out[72]: Index([&#39;OHIO&#39;, &#39;COLO&#39;, &#39;NEW &#39;], dtype=&#39;object&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;OHIO&#39;, &#39;COLO&#39;, &#39;NEW &#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Bạn có thể gán cho thuộc tính <code class="docutils literal notranslate"><span class="pre">index</span></code>, sửa đổi DataFrame trực tiếp:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
<span class="n">data</span>
<span class="c1"># Out[74]:</span>
<span class="c1">#        one  two  three  four</span>
<span class="c1"># OHIO     0    1      2     3</span>
<span class="c1"># COLO     4    5      6     7</span>
<span class="c1"># NEW      8    9     10    11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>three</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>OHIO</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>COLO</th>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>NEW</th>
      <td>8</td>
      <td>9</td>
      <td>10</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Nếu bạn muốn tạo một phiên bản đã được chuyển đổi của một tập dữ liệu mà không sửa đổi bản gốc, một phương thức hữu ích là <code class="docutils literal notranslate"><span class="pre">rename</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">)</span>
<span class="c1"># Out[75]:</span>
<span class="c1">#        ONE  TWO  THREE  FOUR</span>
<span class="c1"># Ohio     0    1      2     3</span>
<span class="c1"># Colo     4    5      6     7</span>
<span class="c1"># New      8    9     10    11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ONE</th>
      <th>TWO</th>
      <th>THREE</th>
      <th>FOUR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Ohio</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Colo</th>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>New</th>
      <td>8</td>
      <td>9</td>
      <td>10</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Đáng chú ý là <code class="docutils literal notranslate"><span class="pre">rename</span></code> có thể được sử dụng kết hợp với một đối tượng giống từ điển, cung cấp các giá trị mới cho một tập hợp con các tên hàng hoặc tên cột:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;OHIO&quot;</span><span class="p">:</span> <span class="s2">&quot;INDIANA&quot;</span><span class="p">},</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;three&quot;</span><span class="p">:</span> <span class="s2">&quot;peekaboo&quot;</span><span class="p">})</span>
<span class="c1"># Out[76]:</span>
<span class="c1">#          one  two  peekaboo  four</span>
<span class="c1"># INDIANA    0    1         2     3</span>
<span class="c1"># COLO       4    5         6     7</span>
<span class="c1"># NEW        8    9        10    11</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>one</th>
      <th>two</th>
      <th>peekaboo</th>
      <th>four</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>INDIANA</th>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
    </tr>
    <tr>
      <th>COLO</th>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
    </tr>
    <tr>
      <th>NEW</th>
      <td>8</td>
      <td>9</td>
      <td>10</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">rename</span></code> giúp bạn không phải thực hiện công việc sao chép DataFrame thủ công và gán các giá trị mới cho các thuộc tính <code class="docutils literal notranslate"><span class="pre">index</span></code> và <code class="docutils literal notranslate"><span class="pre">columns</span></code> của nó.</p>
</section>
<section id="roi-rac-hoa-va-phan-nhom">
<h3><span class="section-number">8.2.5. </span>Rời rạc hóa và phân nhóm<a class="headerlink" href="#roi-rac-hoa-va-phan-nhom" title="Link to this heading">#</a></h3>
<p>Trong nhiều trường hợp, dữ liệu liên tục thường được rời rạc hóa hoặc tách thành các nhóm (bins) để phân tích. Giả sử bạn có dữ liệu về một nhóm người trong một nghiên cứu và bạn muốn nhóm họ thành các nhóm tuổi riêng biệt:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Yêu cầu đặt ra là chia những tuổi này thành các nhóm từ 18 đến 25, 26 đến 35, 36 đến 60 và cuối cùng là 61 tuổi trở lên. Để làm điều này, bạn phải sử dụng <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">18</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">age_categories</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">age_categories</span>
<span class="c1"># Out[80]:</span>
<span class="c1"># [(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]</span>
<span class="c1"># Length: 12</span>
<span class="c1"># Categories (4, interval[int64, right]): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]
Length: 12
Categories (4, interval[int64, right]): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]
</pre></div>
</div>
</div>
</div>
<p>Đối tượng mà <code class="docutils literal notranslate"><span class="pre">pandas</span></code> trả về là một đối tượng kiểu phân loại, hay categorical, đặc biệt. Kết quả hiển thị mô tả các nhóm được tính toán bởi <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code>. Mỗi nhóm được xác định bởi một kiểu giá trị khoảng đặc biệt chứa giới hạn dưới và giới hạn trên của mỗi nhóm:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">age_categories</span><span class="o">.</span><span class="n">codes</span>
<span class="c1"># Out[81]: array([0, 0, 0, 1, 0, 0, 2, 1, 3, 2, 2, 1], dtype=int8)</span>

<span class="n">age_categories</span><span class="o">.</span><span class="n">categories</span>
<span class="c1"># Out[82]: IntervalIndex([(18, 25], (25, 35], (35, 60], (60, 100]],</span>
<span class="c1">#           dtype=&#39;interval[int64, right]&#39;)</span>

<span class="n">age_categories</span><span class="o">.</span><span class="n">categories</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Out[83]: Interval(18, 25, closed=&#39;right&#39;)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">age_categories</span><span class="p">)</span>
<span class="c1"># Out[84]:</span>
<span class="c1"># (18, 25]     5</span>
<span class="c1"># (25, 35]     3</span>
<span class="c1"># (35, 60]     3</span>
<span class="c1"># (60, 100]    1</span>
<span class="c1"># Name: count, dtype: int64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(18, 25]     5
(25, 35]     3
(35, 60]     3
(60, 100]    1
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Lưu ý rằng <code class="docutils literal notranslate"><span class="pre">pd.value_counts(categories)</span></code> là số lượng nhóm cho kết quả của <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code>.</p>
<p>Trong biểu diễn chuỗi của một khoảng, một dấu ngoặc đơn có nghĩa là phía đó mở (không bao gồm), trong khi dấu ngoặc vuông có nghĩa là phía đó đóng (bao gồm). Bạn có thể thay đổi phía nào được đóng bằng cách truyền <code class="docutils literal notranslate"><span class="pre">right=False</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Out[85]:</span>
<span class="c1"># [[18, 25), [18, 25), [25, 35), [25, 35), [18, 25), ..., [25, 35), [60, 100), [35, 60), [35, 60), [25, 35)]</span>
<span class="c1"># Length: 12</span>
<span class="c1"># Categories (4, interval[int64, left]): [[18, 25) &lt; [25, 35) &lt; [35, 60) &lt; [60, 100)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[18, 25), [18, 25), [25, 35), [25, 35), [18, 25), ..., [25, 35), [60, 100), [35, 60), [35, 60), [25, 35)]
Length: 12
Categories (4, interval[int64, left]): [[18, 25) &lt; [25, 35) &lt; [35, 60) &lt; [60, 100)]
</pre></div>
</div>
</div>
</div>
<p>Bạn có thể ghi đè tên nhóm dựa trên khoảng mặc định bằng cách truyền một danh sách hoặc mảng cho tùy chọn <code class="docutils literal notranslate"><span class="pre">labels</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">group_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Youth&quot;</span><span class="p">,</span> <span class="s2">&quot;YoungAdult&quot;</span><span class="p">,</span> <span class="s2">&quot;MiddleAged&quot;</span><span class="p">,</span> <span class="s2">&quot;Senior&quot;</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">group_names</span><span class="p">)</span>
<span class="c1"># Out[87]:</span>
<span class="c1"># [&#39;Youth&#39;, &#39;Youth&#39;, &#39;Youth&#39;, &#39;YoungAdult&#39;, &#39;Youth&#39;, ..., &#39;YoungAdult&#39;, &#39;Senior&#39;, &#39;MiddleAged&#39;, &#39;MiddleAged&#39;, &#39;YoungAdult&#39;]</span>
<span class="c1"># Length: 12</span>
<span class="c1"># Categories (4, object): [&#39;Youth&#39; &lt; &#39;YoungAdult&#39; &lt; &#39;MiddleAged&#39; &lt; &#39;Senior&#39;]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Youth&#39;, &#39;Youth&#39;, &#39;Youth&#39;, &#39;YoungAdult&#39;, &#39;Youth&#39;, ..., &#39;YoungAdult&#39;, &#39;Senior&#39;, &#39;MiddleAged&#39;, &#39;MiddleAged&#39;, &#39;YoungAdult&#39;]
Length: 12
Categories (4, object): [&#39;Youth&#39; &lt; &#39;YoungAdult&#39; &lt; &#39;MiddleAged&#39; &lt; &#39;Senior&#39;]
</pre></div>
</div>
</div>
</div>
<p>Nếu bạn gán một số nguyên, truyền tham số số lượng nhóm vào <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code> thay vì các giới hạn nhóm rõ ràng, <code class="docutils literal notranslate"><span class="pre">pandas</span></code> sẽ tính toán các nhóm có chiều dài bằng nhau dựa trên các giá trị tối thiểu và tối đa trong dữ liệu. Hãy xem xét trường hợp một số dữ liệu được phân bố đều được chia thành bốn phần:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Out[89]:</span>
<span class="c1"># [(0.34, 0.55], (0.34, 0.55], (0.76, 0.97], (0.76, 0.97], (0.34, 0.55], ...,</span>
<span class="c1">#  (0.34, 0.55], (0.34, 0.55], (0.55, 0.76], (0.34, 0.55], (0.12, 0.34]]</span>
<span class="c1"># Length: 20</span>
<span class="c1"># Categories (4, interval[float64, right]): [(0.12, 0.34] &lt; (0.34, 0.55] &lt; (0.55, 0.76] &lt; (0.76, 0.97]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(0.34, 0.55], (0.34, 0.55], (0.76, 0.97], (0.76, 0.97], (0.34, 0.55], ..., (0.34, 0.55], (0.34, 0.55], (0.55, 0.76], (0.34, 0.55], (0.12, 0.34]]
Length: 20
Categories (4, interval[float64, right]): [(0.12, 0.34] &lt; (0.34, 0.55] &lt; (0.55, 0.76] &lt; (0.76, 0.97]]
</pre></div>
</div>
</div>
</div>
<p>Tùy chọn <code class="docutils literal notranslate"><span class="pre">precision=2</span></code> giới hạn độ chính xác thập phân đến hai chữ số.</p>
<p>Một hàm liên quan chặt chẽ đến phân nhóm dữ liệu là <code class="docutils literal notranslate"><span class="pre">pandas.qcut</span></code> có thể phân nhóm dữ liệu dựa trên các phân vị. Tùy thuộc vào sự phân bố của dữ liệu, việc sử dụng <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code> thường sẽ không dẫn đến việc mỗi nhóm có cùng số lượng điểm dữ liệu. Vì <code class="docutils literal notranslate"><span class="pre">pandas.qcut</span></code> sử dụng các phân vị mẫu thay vào đó, bạn sẽ thu được các nhóm có kích thước gần bằng nhau:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">quartiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">quartiles</span>
<span class="c1"># Out[92]:</span>
<span class="c1"># [(-0.026, 0.62], (0.62, 3.93], (-0.68, -0.026], (0.62, 3.93], (-0.026, 0.62], ...,</span>
<span class="c1">#  (-0.68, -0.026], (-0.68, -0.026], (-2.96, -0.68], (0.62, 3.93], (-0.68, -0.026]]</span>
<span class="c1"># Length: 1000</span>
<span class="c1"># Categories (4, interval[float64, right]): [(-2.96, -0.68] &lt; (-0.68, -0.026] &lt; (-0.026, 0.62] &lt; (0.62, 3.93]]</span>

<span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">quartiles</span><span class="p">)</span>
<span class="c1"># Out[93]:</span>
<span class="c1"># (-2.96, -0.68]     250</span>
<span class="c1"># (-0.68, -0.026]    250</span>
<span class="c1"># (-0.026, 0.62]     250</span>
<span class="c1"># (0.62, 3.93]      250</span>
<span class="c1"># Name: count, dtype: int64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-2.96, -0.68]     250
(-0.68, -0.026]    250
(-0.026, 0.62]     250
(0.62, 3.93]       250
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Tương tự như <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code>, bạn có thể tự tạo các phân vị theo ý mình mình:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="c1"># Out[94]:</span>
<span class="c1"># (-2.9499999999999997, -1.187]    100</span>
<span class="c1"># (-1.187, -0.0265]               400</span>
<span class="c1"># (-0.0265, 1.286]                400</span>
<span class="c1"># (1.286, 3.928]                  100</span>
<span class="c1"># Name: count, dtype: int64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-2.9499999999999997, -1.187]    100
(-1.187, -0.0265]                400
(-0.0265, 1.286]                 400
(1.286, 3.928]                   100
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Chúng ta sẽ quay lại <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code> và <code class="docutils literal notranslate"><span class="pre">pandas.qcut</span></code> sau trong chương này trong phần thảo luận về tổng hợp và các thao tác nhóm, vì các hàm rời rạc hóa này đặc biệt hữu ích cho phân tích phân vị và nhóm.</p>
</section>
<section id="phat-hien-va-xu-ly-cac-gia-tri-ngoai-lai">
<h3><span class="section-number">8.2.6. </span>Phát hiện và xử lý các giá trị ngoại lai<a class="headerlink" href="#phat-hien-va-xu-ly-cac-gia-tri-ngoai-lai" title="Link to this heading">#</a></h3>
<p>Việc lọc hoặc chuyển đổi các giá trị ngoại lai (outliers) phần lớn là được thao tác bằng các phép toán mảng. Hãy xem xét một DataFrame có một số dữ liệu phân phối chuẩn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">4</span><span class="p">)))</span>
<span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1"># Out[96]:</span>
<span class="c1">#                0           1           2           3</span>
<span class="c1"># count  1000.000000  1000.000000  1000.000000  1000.000000</span>
<span class="c1"># mean      0.049091    0.026112   -0.002544   -0.051827</span>
<span class="c1"># std       0.996947    1.007458    0.995232    0.998311</span>
<span class="c1"># min      -3.645860   -3.184377   -3.745356   -3.428254</span>
<span class="c1"># 25%      -0.599807   -0.612162   -0.687373   -0.747478</span>
<span class="c1"># 50%       0.047101   -0.013609   -0.022158   -0.088274</span>
<span class="c1"># 75%       0.756646    0.695298    0.699046    0.623331</span>
<span class="c1"># max       2.653656    3.525865    2.735527    3.366626</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.049091</td>
      <td>0.026112</td>
      <td>-0.002544</td>
      <td>-0.051827</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.996947</td>
      <td>1.007458</td>
      <td>0.995232</td>
      <td>0.998311</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-3.645860</td>
      <td>-3.184377</td>
      <td>-3.745356</td>
      <td>-3.428254</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.599807</td>
      <td>-0.612162</td>
      <td>-0.687373</td>
      <td>-0.747478</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.047101</td>
      <td>-0.013609</td>
      <td>-0.022158</td>
      <td>-0.088274</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.756646</td>
      <td>0.695298</td>
      <td>0.699046</td>
      <td>0.623331</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.653656</td>
      <td>3.525865</td>
      <td>2.735527</td>
      <td>3.366626</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Giả sử bạn muốn tìm các giá trị trong một trong các cột vượt quá 3 về giá trị tuyệt đối:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">col</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span>
<span class="c1"># Out[98]:</span>
<span class="c1"># 41    -3.399312</span>
<span class="c1"># 136   -3.745356</span>
<span class="c1"># Name: 2, dtype: float64</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>41    -3.399312
136   -3.745356
Name: 2, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Để chọn tất cả các hàng có một giá trị vượt quá 3 hoặc –3, bạn có thể sử dụng phương thức <code class="docutils literal notranslate"><span class="pre">any</span></code> trên một DataFrame chứa toàn các giá trị logical:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;columns&quot;</span><span class="p">)]</span>
<span class="c1"># Out[99]:</span>
<span class="c1">#             0         1         2         3</span>
<span class="c1"># 41   0.457246 -0.025907 -3.399312 -0.974657</span>
<span class="c1"># 60   1.951312  3.260383  0.963301  1.201206</span>
<span class="c1"># 136  0.508391 -0.196713 -3.745356 -1.520113</span>
<span class="c1"># 235 -0.242459 -3.056990  1.918403 -0.578828</span>
<span class="c1"># 258  0.682841  0.326045  0.425384 -3.428254</span>
<span class="c1"># 322  1.179227 -3.184377  1.369891 -1.074833</span>
<span class="c1"># 544 -3.548824  1.553205 -2.186301  1.277104</span>
<span class="c1"># 635 -0.578093  0.193299  1.397822  3.366626</span>
<span class="c1"># 782 -0.207434  3.525865  0.283070  0.544635</span>
<span class="c1"># 803 -3.645860  0.255475 -0.549574 -1.907459</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>41</th>
      <td>0.457246</td>
      <td>-0.025907</td>
      <td>-3.399312</td>
      <td>-0.974657</td>
    </tr>
    <tr>
      <th>60</th>
      <td>1.951312</td>
      <td>3.260383</td>
      <td>0.963301</td>
      <td>1.201206</td>
    </tr>
    <tr>
      <th>136</th>
      <td>0.508391</td>
      <td>-0.196713</td>
      <td>-3.745356</td>
      <td>-1.520113</td>
    </tr>
    <tr>
      <th>235</th>
      <td>-0.242459</td>
      <td>-3.056990</td>
      <td>1.918403</td>
      <td>-0.578828</td>
    </tr>
    <tr>
      <th>258</th>
      <td>0.682841</td>
      <td>0.326045</td>
      <td>0.425384</td>
      <td>-3.428254</td>
    </tr>
    <tr>
      <th>322</th>
      <td>1.179227</td>
      <td>-3.184377</td>
      <td>1.369891</td>
      <td>-1.074833</td>
    </tr>
    <tr>
      <th>544</th>
      <td>-3.548824</td>
      <td>1.553205</td>
      <td>-2.186301</td>
      <td>1.277104</td>
    </tr>
    <tr>
      <th>635</th>
      <td>-0.578093</td>
      <td>0.193299</td>
      <td>1.397822</td>
      <td>3.366626</td>
    </tr>
    <tr>
      <th>782</th>
      <td>-0.207434</td>
      <td>3.525865</td>
      <td>0.283070</td>
      <td>0.544635</td>
    </tr>
    <tr>
      <th>803</th>
      <td>-3.645860</td>
      <td>0.255475</td>
      <td>-0.549574</td>
      <td>-1.907459</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Dấu ngoặc đơn xung quanh <code class="docutils literal notranslate"><span class="pre">data.abs()</span> <span class="pre">&gt;</span> <span class="pre">3</span></code> là cần thiết để gọi phương thức <code class="docutils literal notranslate"><span class="pre">any</span></code> trên kết quả của phép toán so sánh.</p>
<p>Các giá trị có thể được đặt dựa trên các tiêu chí này. Đoạn câu lệnh dưới đây là để giới hạn các giá trị nằm ngoài khoảng từ –3 đến 3:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="c1"># Out[101]:</span>
<span class="c1">#                0           1           2           3</span>
<span class="c1"># count  1000.000000  1000.000000  1000.000000  1000.000000</span>
<span class="c1"># mean      0.050286    0.025567   -0.001399   -0.051765</span>
<span class="c1"># std       0.992920    1.004214    0.991414    0.995761</span>
<span class="c1"># min      -3.000000   -3.000000   -3.000000   -3.000000</span>
<span class="c1"># 25%      -0.599807   -0.612162   -0.687373   -0.747478</span>
<span class="c1"># 50%       0.047101   -0.013609   -0.022158   -0.088274</span>
<span class="c1"># 75%       0.756646    0.695298    0.699046    0.623331</span>
<span class="c1"># max       2.653656    3.000000    2.735527    3.000000</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.050286</td>
      <td>0.025567</td>
      <td>-0.001399</td>
      <td>-0.051765</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.992920</td>
      <td>1.004214</td>
      <td>0.991414</td>
      <td>0.995761</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
      <td>-3.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-0.599807</td>
      <td>-0.612162</td>
      <td>-0.687373</td>
      <td>-0.747478</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.047101</td>
      <td>-0.013609</td>
      <td>-0.022158</td>
      <td>-0.088274</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.756646</td>
      <td>0.695298</td>
      <td>0.699046</td>
      <td>0.623331</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.653656</td>
      <td>3.000000</td>
      <td>2.735527</td>
      <td>3.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Câu lệnh <code class="docutils literal notranslate"><span class="pre">np.sign(data)</span></code> tạo ra các giá trị 1 và –1 dựa trên việc các giá trị trong <code class="docutils literal notranslate"><span class="pre">data</span></code> là dương hay âm:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1"># Out[102]:</span>
<span class="c1">#      0    1    2    3</span>
<span class="c1"># 0 -1.0  1.0 -1.0  1.0</span>
<span class="c1"># 1  1.0 -1.0  1.0 -1.0</span>
<span class="c1"># 2  1.0  1.0  1.0 -1.0</span>
<span class="c1"># 3 -1.0 -1.0  1.0 -1.0</span>
<span class="c1"># 4 -1.0  1.0 -1.0 -1.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.0</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-1.0</td>
      <td>1.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-1.0</td>
      <td>-1.0</td>
      <td>1.0</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.0</td>
      <td>1.0</td>
      <td>-1.0</td>
      <td>-1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="tinh-toan-bien-chi-bao">
<h3><span class="section-number">8.2.7. </span>Tính toán biến chỉ báo<a class="headerlink" href="#tinh-toan-bien-chi-bao" title="Link to this heading">#</a></h3>
<p>Một kiểu biến đổi biến thường được sử dụng cho mục đích xây dựng mô hình thống kê hoặc các ứng dụng học máy là chuyển đổi một biến phân loại thành một ma trận biến giả hay biến chỉ báo. Nếu một cột trong DataFrame có <em>J</em> giá trị riêng biệt, bạn sẽ tạo ra một ma trận hoặc DataFrame mới có <em>J</em> cột chỉ chứa giá trị 0 và 1. Trong thư viện <code class="docutils literal notranslate"><span class="pre">pandas</span></code> có hàm <code class="docutils literal notranslate"><span class="pre">pandas.get_dummies</span></code> để thực hiện điều này:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">],</span>
                   <span class="s2">&quot;data1&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)})</span>
<span class="n">df</span>
<span class="c1"># Out[116]:</span>
<span class="c1">#   key  data1</span>
<span class="c1"># 0   b      0</span>
<span class="c1"># 1   b      1</span>
<span class="c1"># 2   a      2</span>
<span class="c1"># 3   c      3</span>
<span class="c1"># 4   a      4</span>
<span class="c1"># 5   b      5</span>

<span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="c1"># Out[117]:</span>
<span class="c1">#      a    b    c</span>
<span class="c1"># 0  0.0  1.0  0.0</span>
<span class="c1"># 1  0.0  1.0  0.0</span>
<span class="c1"># 2  1.0  0.0  0.0</span>
<span class="c1"># 3  0.0  0.0  1.0</span>
<span class="c1"># 4  1.0  0.0  0.0</span>
<span class="c1"># 5  0.0  1.0  0.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Trong hàm <code class="docutils literal notranslate"><span class="pre">get_dummies</span></code> đã sử dụng tham số <code class="docutils literal notranslate"><span class="pre">dtype=float</span></code> để thay đổi kiểu đầu ra sang số thực.</p>
<p>Trong một số trường hợp, bạn có thể muốn thêm một tiền tố vào tên các cột trong DataFrame. <code class="docutils literal notranslate"><span class="pre">pandas.get_dummies</span></code> có tham số <code class="docutils literal notranslate"><span class="pre">prefix</span></code> để thực hiện việc này:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">df_with_dummy</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;data1&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dummies</span><span class="p">)</span>
<span class="n">df_with_dummy</span>
<span class="c1"># Out[120]:</span>
<span class="c1">#    data1  key_a  key_b  key_c</span>
<span class="c1"># 0      0    0.0    1.0    0.0</span>
<span class="c1"># 1      1    0.0    1.0    0.0</span>
<span class="c1"># 2      2    1.0    0.0    0.0</span>
<span class="c1"># 3      3    0.0    0.0    1.0</span>
<span class="c1"># 4      4    1.0    0.0    0.0</span>
<span class="c1"># 5      5    0.0    1.0    0.0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data1</th>
      <th>key_a</th>
      <th>key_b</th>
      <th>key_c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Phương thức <code class="docutils literal notranslate"><span class="pre">join</span></code> sử dụng ở trên sẽ được giải thích chi tiết hơn trong chương tiếp theo.</p>
<p>Nếu một hàng trong <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> thuộc về nhiều danh mục, chúng ta phải sử dụng một cách tiếp cận khác để tạo các biến giả. Hãy xem ví dụ về dữ liệu dưới đây:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;movie_id&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;genres&quot;</span><span class="p">]</span>
<span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;datasets/movielens/movies.dat&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;::&quot;</span><span class="p">,</span>
                       <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">mnames</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="n">movies</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="c1"># Out[123]:</span>
<span class="c1">#    movie_id                               title                        genres</span>
<span class="c1"># 0         1                    Toy Story (1995)   Animation|Children&#39;s|Comedy</span>
<span class="c1"># 1         2                      Jumanji (1995)  Adventure|Children&#39;s|Fantasy</span>
<span class="c1"># 2         3             Grumpier Old Men (1995)                Comedy|Romance</span>
<span class="c1"># 3         4            Waiting to Exhale (1995)                  Comedy|Drama</span>
<span class="c1"># 4         5  Father of the Bride Part II (1995)                        Comedy</span>
<span class="c1"># 5         6                         Heat (1995)          Action|Crime|Thriller</span>
<span class="c1"># 6         7                      Sabrina (1995)                Comedy|Romance</span>
<span class="c1"># 7         8                 Tom and Huck (1995)          Adventure|Children&#39;s</span>
<span class="c1"># 8         9                  Sudden Death (1995)                        Action</span>
<span class="c1"># 9        10                    GoldenEye (1995)      Action|Adventure|Thriller</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">49</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">mnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;movie_id&quot;</span><span class="p">,</span> <span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;genres&quot;</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s2">&quot;datasets/movielens/movies.dat&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;::&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                        <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">mnames</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">movies</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># Out[123]:</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1">#    movie_id                               title                        genres</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="c1"># 0         1                    Toy Story (1995)   Animation|Children&#39;s|Comedy</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>     <span class="mi">15</span> <span class="c1"># 8         9                  Sudden Death (1995)                        Action</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="c1"># 9        10                    GoldenEye (1995)      Action|Adventure|Thriller</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\io\parsers\readers.py:1405,</span> in <span class="ni">read_table</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, date_format, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options, dtype_backend)</span>
<span class="g g-Whitespace">   </span><span class="mi">1392</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1393</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1394</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>   <span class="mi">1401</span>     <span class="n">dtype_backend</span><span class="o">=</span><span class="n">dtype_backend</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1402</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1403</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1405</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\io\parsers\readers.py:620,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">617</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">619</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">620</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">622</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\io\parsers\readers.py:1620,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1617</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1619</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1620</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\io\parsers\readers.py:1880,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1878</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1879</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1880</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1881</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1882</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1883</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1884</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1885</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1886</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1887</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1888</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1889</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1890</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1891</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~\AppData\Local\Programs\Python\Python313\Lib\site-packages\pandas\io\common.py:873,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">870</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">873</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">874</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">875</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">876</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">877</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">878</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">880</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">881</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">882</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;datasets/movielens/movies.dat&#39;
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pandas</span></code> có phương thức dành cho chuỗi ký tự <code class="docutils literal notranslate"><span class="pre">str.get_dummies</span></code> có thể xử lý trường hợp này:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dummies</span> <span class="o">=</span> <span class="n">movies</span><span class="p">[</span><span class="s2">&quot;genres&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
<span class="n">dummies</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">,</span> <span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="c1"># Out[125]:</span>
<span class="c1">#    Action  Adventure  Animation  Children&#39;s  Comedy  Crime</span>
<span class="c1"># 0       0          0          1           1       1      0</span>
<span class="c1"># 1       0          1          0           1       0      0</span>
<span class="c1"># 2       0          0          0           0       1      0</span>
<span class="c1"># 3       0          0          0           0       1      0</span>
<span class="c1"># 4       0          0          0           0       1      0</span>
<span class="c1"># 5       1          0          0           0       0      1</span>
<span class="c1"># 6       0          0          0           0       1      0</span>
<span class="c1"># 7       0          1          0           1       0      0</span>
<span class="c1"># 8       1          0          0           0       0      0</span>
<span class="c1"># 9       1          1          0           0       0      0</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p><strong>Lưu ý</strong>: Đối với dữ liệu lớn hơn, phương pháp xây dựng các biến phân loại nhận nhiều giá trị sẽ không hiệu quả về thời gian. Sẽ tốt hơn nếu viết chúng ta xử lý dưới dạng mảng trong NumPy, sau đó chuyển sang kiểu DataFrame.</p>
</div></blockquote>
<p>Một công thức hữu ích cho các ứng dụng thống kê là kết hợp <code class="docutils literal notranslate"><span class="pre">pandas.get_dummies</span></code> với một hàm rời rạc hóa như <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span> <span class="c1"># để làm cho ví dụ có thể lặp lại</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">values</span>
<span class="c1"># Out[130]: array([0.9296, 0.3164, 0.1839, 0.2046, 0.5677, 0.5955, 0.9645, 0.6532,</span>
<span class="c1">#        0.7489, 0.6536])</span>

<span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="p">))</span>
<span class="c1"># Out[132]:</span>
<span class="c1">#    (0.0, 0.2]  (0.2, 0.4]  (0.4, 0.6]  (0.6, 0.8]  (0.8, 1.0]</span>
<span class="c1"># 0       False       False       False       False        True</span>
<span class="c1"># 1       False        True       False       False       False</span>
<span class="c1"># 2        True       False       False       False       False</span>
<span class="c1"># 3       False        True       False       False       False</span>
<span class="c1"># 4       False       False        True       False       False</span>
<span class="c1"># 5       False       False        True       False       False</span>
<span class="c1"># 6       False       False       False       False        True</span>
<span class="c1"># 7       False       False       False        True       False</span>
<span class="c1"># 8       False       False       False        True       False</span>
<span class="c1"># 9       False       False       False        True       False</span>
</pre></div>
</div>
</div>
</div>
<p>Chúng ta sẽ xem lại <code class="docutils literal notranslate"><span class="pre">pandas.get_dummies</span></code> sau các phần tiếp theo của sách.</p>
</section>
</section>
<section id="thao-tac-tren-chuoi-ky-tu">
<h2><span class="section-number">8.3. </span>Thao tác trên chuỗi ký tự<a class="headerlink" href="#thao-tac-tren-chuoi-ky-tu" title="Link to this heading">#</a></h2>
<hr><p>Python từ lâu đã là một ngôn ngữ phổ biến để thao tác dữ liệu thô một phần nhờ vào sự dễ dàng trong việc xử lý chuỗi và văn bản. Hầu hết các thao tác văn bản đều khả thi với các phương thức tích hợp sẵn của đối tượng chuỗi. Đối với các thao tác xử lý văn bản phức tạp hơn, có thể cần đến các <strong>biểu thức chính quy</strong>. <code class="docutils literal notranslate"><span class="pre">pandas</span></code> bổ sung vào đó bằng cách cho phép bạn áp dụng các biểu thức chuỗi và biểu thức chính quy một cách ngắn gọn trên toàn bộ mảng dữ liệu, đồng thời xử lý sự phiền phức của dữ liệu bị thiếu.</p>
<section id="cac-phuong-thuc-doi-tuong-chuoi-ky-tu-tich-hop-san-cua-python">
<h3><span class="section-number">8.3.1. </span>Các phương thức đối tượng chuỗi ký tự tích hợp sẵn của Python<a class="headerlink" href="#cac-phuong-thuc-doi-tuong-chuoi-ky-tu-tich-hop-san-cua-python" title="Link to this heading">#</a></h3>
<p>Trong nhiều ứng dụng xử lý chuỗi và viết kịch bản, các phương thức chuỗi tích hợp sẵn là đủ. Ví dụ, một chuỗi được phân tách bằng dấu phẩy có thể được chia thành các phần bằng <code class="docutils literal notranslate"><span class="pre">split</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;a,b,  guido&quot;</span>
<span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="c1"># Out[152]: [&#39;a&#39;, &#39;b&#39;, &#39; guido&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">split</span></code> thường được kết hợp với <code class="docutils literal notranslate"><span class="pre">strip</span></code> để loại bỏ khoảng trắng, bao gồm cả ngắt dòng:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pieces</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
<span class="n">pieces</span>
<span class="c1"># Out[154]: [&#39;a&#39;, &#39;b&#39;, &#39;guido&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Các chuỗi ký tự con này có thể được nối lại với nhau bằng một dấu hai chấm kép làm dấu phân cách bằng cách sử dụng phép cộng:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">third</span> <span class="o">=</span> <span class="n">pieces</span>
<span class="n">first</span> <span class="o">+</span> <span class="s2">&quot;::&quot;</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="s2">&quot;::&quot;</span> <span class="o">+</span> <span class="n">third</span>
<span class="c1"># Out[156]: &#39;a::b::guido&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Nhưng đây không phải là một phương pháp chung thực tế. Một cách nhanh hơn là sử dụng phương thức <code class="docutils literal notranslate"><span class="pre">join</span></code> trên chuỗi <code class="docutils literal notranslate"><span class="pre">&quot;::&quot;</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;::&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span>
<span class="c1"># Out[157]: &#39;a::b::guido&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Có các phương thức khác liên quan đến việc định vị chuỗi con. Sử dụng từ khóa <code class="docutils literal notranslate"><span class="pre">in</span></code> của Python là cách tốt nhất để phát hiện một chuỗi con, mặc dù <code class="docutils literal notranslate"><span class="pre">index</span></code> và <code class="docutils literal notranslate"><span class="pre">find</span></code> cũng có thể được sử dụng:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;guido&quot;</span> <span class="ow">in</span> <span class="n">val</span>
<span class="c1"># Out[158]: True</span>

<span class="n">val</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="c1"># Out[159]: 1</span>

<span class="n">val</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="c1"># Out[160]: -1</span>
</pre></div>
</div>
</div>
</div>
<p>Lưu ý rằng sự khác biệt giữa <code class="docutils literal notranslate"><span class="pre">find</span></code> và <code class="docutils literal notranslate"><span class="pre">index</span></code> là <code class="docutils literal notranslate"><span class="pre">index</span></code> sẽ báo lỗi nếu chuỗi ký tự không được tìm thấy thay vì trả về –1:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># val.index(&quot;:&quot;)</span>
<span class="c1"># ---------------------------------------------------------------------------</span>
<span class="c1"># ValueError                                Traceback (most recent call last)</span>
<span class="c1"># &lt;ipython-input-161-bea4c4c30248&gt; in &lt;module&gt;</span>
<span class="c1"># ----&gt; 1 val.index(&quot;:&quot;)</span>
<span class="c1"># </span>
<span class="c1"># ValueError: substring not found</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
&lt;ipython-input-161-bea4c4c30248&gt; in &lt;module&gt;
----&gt; 1 val.index(&quot;:&quot;)

ValueError: substring not found
</pre></div>
</div>
</div>
</div>
<p>Liên quan đến điều này, <code class="docutils literal notranslate"><span class="pre">count</span></code> trả về số lần xuất hiện của một chuỗi con cụ thể:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">val</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<span class="c1"># Out[162]: 2</span>
</pre></div>
</div>
</div>
</div>
<p>Phương thức <code class="docutils literal notranslate"><span class="pre">replace</span></code> sẽ thay thế các lần xuất hiện của một chuỗi ký tự bằng một chuỗi ký tự khác. Phương thức này cũng thường được sử dụng để xóa các chuỗi ký tự bằng cách truyền một chuỗi ký tự trống:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;::&quot;</span><span class="p">)</span>
<span class="c1"># Out[163]: &#39;a::b:: guido&#39;</span>

<span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="c1"># Out[164]: &#39;ab guido&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Xem Bảng …. liệt kê danh sách các phương thức chuỗi của Python.</p>
<p><strong>Bảng … các phương thức chuỗi tích hợp sẵn của Python</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Phương thức</p></th>
<th class="head"><p>Mô tả</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">count</span></code></p></td>
<td><p>Trả về số lần xuất hiện không chồng chéo của chuỗi con trong chuỗi.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">endswith</span></code></p></td>
<td><p>Trả về <code class="docutils literal notranslate"><span class="pre">True</span></code> nếu chuỗi kết thúc bằng hậu tố.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">startswith</span></code></p></td>
<td><p>Trả về <code class="docutils literal notranslate"><span class="pre">True</span></code> nếu chuỗi bắt đầu bằng tiền tố.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">join</span></code></p></td>
<td><p>Sử dụng chuỗi làm dấu phân cách để nối một chuỗi các chuỗi khác.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">index</span></code></p></td>
<td><p>Trả về chỉ mục bắt đầu của lần xuất hiện đầu tiên của chuỗi con được truyền nếu tìm thấy trong chuỗi; ngược lại, gây ra <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> nếu không tìm thấy.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">find</span></code></p></td>
<td><p>Trả về vị trí của ký tự đầu tiên của lần xuất hiện đầu tiên của chuỗi con trong chuỗi; giống như <code class="docutils literal notranslate"><span class="pre">index</span></code>, nhưng trả về –1 nếu không tìm thấy.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rfind</span></code></p></td>
<td><p>Trả về vị trí của ký tự đầu tiên của lần xuất hiện cuối cùng của chuỗi con trong chuỗi; trả về –1 nếu không tìm thấy.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">replace</span></code></p></td>
<td><p>Thay thế các lần xuất hiện của chuỗi bằng một chuỗi khác.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">strip</span></code>, <code class="docutils literal notranslate"><span class="pre">rstrip</span></code>, <code class="docutils literal notranslate"><span class="pre">lstrip</span></code></p></td>
<td><p>Loại bỏ khoảng trắng, bao gồm cả ngắt dòng ở cả hai bên, ở bên phải, hoặc ở bên trái, tương ứng.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">split</span></code></p></td>
<td><p>Chia chuỗi thành danh sách các chuỗi con bằng cách sử dụng dấu phân cách được truyền.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">lower</span></code></p></td>
<td><p>Chuyển đổi các ký tự chữ cái thành chữ thường.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">upper</span></code></p></td>
<td><p>Chuyển đổi các ký tự chữ cái thành chữ hoa.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">casefold</span></code></p></td>
<td><p>Chuyển đổi các ký tự thành chữ thường, và chuyển đổi bất kỳ tổ hợp ký tự biến thể theo vùng cụ thể nào thành một dạng chung có thể so sánh được.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ljust</span></code>, <code class="docutils literal notranslate"><span class="pre">rjust</span></code></p></td>
<td><p>Căn lề trái hoặc căn lề phải, tương ứng; đệm phía đối diện của chuỗi bằng khoảng trắng (hoặc một ký tự điền khác) để trả về một chuỗi có chiều rộng tối thiểu.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="bieu-thuc-chinh-quy">
<h3><span class="section-number">8.3.2. </span>Biểu thức chính quy<a class="headerlink" href="#bieu-thuc-chinh-quy" title="Link to this heading">#</a></h3>
<p>Biểu thức chính quy cung cấp một cách linh hoạt để tìm kiếm hoặc mapping các chuỗi ký tự trong văn bản. Một biểu thức, thường được gọi là <em>regex</em>, là một chuỗi được hình thành theo ngôn ngữ biểu thức chính quy. Thư viện <code class="docutils literal notranslate"><span class="pre">re</span></code> tích hợp sẵn của Python cho phép áp dụng các biểu thức chính quy cho các chuỗi; chúng ta sẽ tìm hiểu về <em>regex</em> thông qua một số ví dụ về cách sử dụng.</p>
<blockquote>
<div><p><strong>Lưu ý</strong>: Trình bày đầy đủ về biểu thức chính quy có thể yêu cầu một cuốn sách riêng và do đó nằm ngoài phạm vi của cuốn sách này. Có rất nhiều hướng dẫn và tài liệu tham khảo tuyệt vời có sẵn trên internet và trong các cuốn sách khác.</p>
</div></blockquote>
<p>Các hàm của thư viện <code class="docutils literal notranslate"><span class="pre">re</span></code> được chia thành ba loại: mapping, thay thế và chia tách chuỗi ký tự. Hãy xem một ví dụ đơn giản: giả sử chúng ta muốn chia một chuỗi được phân tách bằng một số lượng ký tự khoảng trắng, có thể là tab, dấu cách hoặc ngắt dòng.</p>
<p>Regex mô tả một hoặc nhiều ký tự khoảng trắng là <code class="docutils literal notranslate"><span class="pre">\s+</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;foo    bar</span><span class="se">\t</span><span class="s2"> baz  </span><span class="se">\t</span><span class="s2">qux&quot;</span>
<span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
<span class="c1"># Out[167]: [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;qux&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Khi bạn gọi <code class="docutils literal notranslate"><span class="pre">re.split(r&quot;\s+&quot;,</span> <span class="pre">text)</span></code>, biểu thức chính quy được biên dịch trước, và sau đó phương thức <code class="docutils literal notranslate"><span class="pre">split</span></code> được gọi trên văn bản được truyền vào. Trong Python, thêm chữ r trước một chuỗi (ví dụ: r”\s+”) nghĩa là bạn đang viết raw string — chuỗi “thô”, để tránh việc phải sử dụng <code class="docutils literal notranslate"><span class="pre">\\</span></code>.</p>
<p>Bạn có thể tự tạo một đối tượng regex có thể tái sử dụng bằng phương thức <code class="docutils literal notranslate"><span class="pre">compile</span></code> như sau</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">)</span>
<span class="n">regex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="c1"># Out[169]: [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;qux&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Nếu bạn muốn lấy một danh sách tất cả các mẫu khớp với regex, bạn có thể sử dụng phương thức <code class="docutils literal notranslate"><span class="pre">findall</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="c1"># Out[170]: [&#39;    &#39;, &#39;\t &#39;, &#39;  \t&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Việc tạo một đối tượng regex bằng <code class="docutils literal notranslate"><span class="pre">re.compile</span></code> được khuyến khích nếu bạn có ý định áp dụng cùng một biểu thức cho nhiều chuỗi; làm như vậy sẽ tiết kiệm thời gian tính toán thay vì phải gọi thư viện <code class="docutils literal notranslate"><span class="pre">re</span></code> cho từng lần.</p>
<p><code class="docutils literal notranslate"><span class="pre">match</span></code> và <code class="docutils literal notranslate"><span class="pre">search</span></code> có liên quan chặt chẽ với <code class="docutils literal notranslate"><span class="pre">findall</span></code>. Trong khi <code class="docutils literal notranslate"><span class="pre">findall</span></code> trả về tất cả các kết quả khớp trong một chuỗi, <code class="docutils literal notranslate"><span class="pre">search</span></code> chỉ trả về kết quả khớp đầu tiên. Chặt chẽ hơn, <code class="docutils literal notranslate"><span class="pre">match</span></code> chỉ khớp ở đầu chuỗi. Hãy xem xét một văn bản và một biểu thức chính quy có khả năng xác định hầu hết các địa chỉ email trong một văn bản:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Dave dave@google.com</span>
<span class="s2">Steve steve@gmail.com</span>
<span class="s2">Rob rob@gmail.com</span>
<span class="s2">Ryan ryan@yahoo.com&quot;&quot;&quot;</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}&quot;</span>

<span class="c1"># re.IGNORECASE làm cho regex không phân biệt chữ hoa chữ thường</span>
<span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Sử dụng <code class="docutils literal notranslate"><span class="pre">findall</span></code> trên văn bản sẽ tạo ra một danh sách các địa chỉ email:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="c1"># Out[172]: [&#39;dave@google.com&#39;, &#39;steve@gmail.com&#39;, &#39;rob@gmail.com&#39;, &#39;ryan@yahoo.com&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">search</span></code> trả về một đối tượng khớp đặc biệt cho địa chỉ email đầu tiên trong văn bản. Đối với regex ở trên, đối tượng khớp chỉ có thể cho chúng ta biết vị trí bắt đầu và kết thúc của mẫu trong chuỗi:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">m</span>
<span class="c1"># Out[174]: &lt;re.Match object; span=(5, 20), match=&#39;dave@google.com&#39;&gt;</span>

<span class="n">text</span><span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">():</span><span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()]</span>
<span class="c1"># Out[175]: &#39;dave@google.com&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">regex.match</span></code> trả về <code class="docutils literal notranslate"><span class="pre">None</span></code>, vì nó sẽ chỉ khớp nếu mẫu xuất hiện ở đầu chuỗi:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
<span class="c1"># Out: None</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>None
</pre></div>
</div>
</div>
</div>
<p>Cũng liên quan đến tìm kiếm và khớp văn bản, <code class="docutils literal notranslate"><span class="pre">sub</span></code> sẽ trả về một chuỗi mới với các lần xuất hiện của mẫu được thay thế bằng một chuỗi mới:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;REDACTED&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
<span class="c1"># Out: </span>
<span class="c1"># Dave REDACTED</span>
<span class="c1"># Steve REDACTED</span>
<span class="c1"># Rob REDACTED</span>
<span class="c1"># Ryan REDACTED</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dave REDACTED
Steve REDACTED
Rob REDACTED
Ryan REDACTED
</pre></div>
</div>
</div>
</div>
<p>Giả sử bạn muốn tìm các địa chỉ email và đồng thời phân đoạn từng địa chỉ thành ba thành phần của nó: tên người dùng, tên miền và hậu tố tên miền. Để làm điều này, hãy đặt dấu ngoặc đơn xung quanh các phần của mẫu để phân đoạn:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]{2,4})&quot;</span>
<span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Một đối tượng khớp được tạo bởi regex đã sửa đổi này trả về một tuple các thành phần mẫu bằng phương thức <code class="docutils literal notranslate"><span class="pre">groups</span></code> của nó:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;wesm@bright.net&quot;</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
<span class="c1"># Out[181]: (&#39;wesm&#39;, &#39;bright.net&#39;, &#39;net&#39;) # Chú ý: trang web gốc có &#39;bright&#39; thay vì &#39;bright.net&#39;, regex của tôi bắt &#39;bright.net&#39;</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">findall</span></code> trả về một danh sách các tuple khi mẫu có các nhóm:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regex</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="c1"># Out[182]: [(&#39;dave&#39;, &#39;google.com&#39;, &#39;com&#39;), (&#39;steve&#39;, &#39;gmail.com&#39;, &#39;com&#39;), (&#39;rob&#39;, &#39;gmail.com&#39;, &#39;com&#39;), (&#39;ryan&#39;, &#39;yahoo.com&#39;, &#39;com&#39;)]</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sub</span></code> cũng có quyền truy cập vào các nhóm trong mỗi kết quả khớp bằng cách sử dụng các ký hiệu đặc biệt như <code class="docutils literal notranslate"><span class="pre">\1</span></code> và <code class="docutils literal notranslate"><span class="pre">\2</span></code>. Ký hiệu <code class="docutils literal notranslate"><span class="pre">\1</span></code> tương ứng với nhóm khớp đầu tiên, <code class="docutils literal notranslate"><span class="pre">\2</span></code> tương ứng với nhóm thứ hai, v.v.:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Username: \1, Domain: \2, Suffix: \3&quot;</span><span class="p">,</span> <span class="n">text</span><span class="p">))</span>
<span class="c1"># Out:</span>
<span class="c1"># Dave Username: dave, Domain: google.com, Suffix: com</span>
<span class="c1"># Steve Username: steve, Domain: gmail.com, Suffix: com</span>
<span class="c1"># Rob Username: rob, Domain: gmail.com, Suffix: com</span>
<span class="c1"># Ryan Username: ryan, Domain: yahoo.com, Suffix: com</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dave Username: dave, Domain: google.com, Suffix: com
Steve Username: steve, Domain: gmail.com, Suffix: com
Rob Username: rob, Domain: gmail.com, Suffix: com
Ryan Username: ryan, Domain: yahoo.com, Suffix: com
</pre></div>
</div>
</div>
</div>
<p>Có rất nhiều điều khác về biểu thức chính quy trong Python, hầu hết nằm ngoài phạm vi của cuốn sách này. Bảng 7.5 cung cấp một bản tóm tắt ngắn gọn.</p>
<p><strong>Bảng … Các phương thức biểu thức chính quy</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Phương thức</p></th>
<th class="head"><p>Mô tả</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">findall</span></code></p></td>
<td><p>Trả về tất cả các mẫu khớp không chồng chéo trong một chuỗi dưới dạng một danh sách.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">finditer</span></code></p></td>
<td><p>Giống như <code class="docutils literal notranslate"><span class="pre">findall</span></code>, nhưng trả về một iterator.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">match</span></code></p></td>
<td><p>Khớp mẫu ở đầu chuỗi và tùy chọn phân đoạn các thành phần mẫu thành các nhóm; nếu mẫu khớp, trả về một đối tượng khớp, ngược lại là <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">search</span></code></p></td>
<td><p>Quét chuỗi để tìm khớp với mẫu, trả về một đối tượng <code class="docutils literal notranslate"><span class="pre">Match</span></code> nếu có; không giống như <code class="docutils literal notranslate"><span class="pre">match</span></code>, khớp có thể ở bất kỳ đâu trong chuỗi thay vì chỉ ở đầu.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">split</span></code></p></td>
<td><p>Chia chuỗi thành các phần ở mỗi lần xuất hiện của mẫu.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sub</span></code>, <code class="docutils literal notranslate"><span class="pre">subn</span></code></p></td>
<td><p>Thay thế tất cả (<code class="docutils literal notranslate"><span class="pre">sub</span></code>) hoặc <em>n</em> lần xuất hiện đầu tiên (<code class="docutils literal notranslate"><span class="pre">subn</span></code>) của mẫu trong chuỗi bằng biểu thức thay thế; sử dụng các ký hiệu <code class="docutils literal notranslate"><span class="pre">\1</span></code>, <code class="docutils literal notranslate"><span class="pre">\2</span></code>, … để tham chiếu đến các phần tử nhóm khớp trong chuỗi thay thế.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="du-lieu-kieu-phan-loai">
<h2><span class="section-number">8.4. </span>Dữ liệu kiểu phân loại<a class="headerlink" href="#du-lieu-kieu-phan-loai" title="Link to this heading">#</a></h2>
<p>Phần này của chương giới thiệu về kiểu dữ liệu phân loại, hay còn gọi là <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> của pandas.  Trước hết, chúng ta thảo luận về cách có thể đạt được hiệu suất tốt hơn và sử dụng bộ nhớ ít hơn trong một số hoạt động pandas bằng cách sử dụng nó. Sau đó, chúng ta sẽ được làm quen với một số công cụ có thể giúp sử dụng dữ liệu phân loại trong phân tích dữ liệu và xây dựng mô hình.</p>
<section id="du-lieu-kieu-phan-loai-la-gi">
<h3><span class="section-number">8.4.1. </span>Dữ liệu kiểu phân loại là gì?<a class="headerlink" href="#du-lieu-kieu-phan-loai-la-gi" title="Link to this heading">#</a></h3>
<p>Rất thường gặp trong thực tế dữ liệu là một cột trong bảng có thể chứa các giá trị lặp đi lặp lại của một tập nhỏ hơn các giá trị riêng biệt. Chúng ta đã thấy các hàm như <code class="docutils literal notranslate"><span class="pre">unique</span></code> và <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> cho phép trích xuất các giá trị riêng biệt từ một mảng và tính toán tần suất của chúng, tương ứng:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;apple&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;apple&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">values</span>
<span class="c1"># Out[200]:</span>
<span class="c1"># 0     apple</span>
<span class="c1"># 1    orange</span>
<span class="c1"># 2     apple</span>
<span class="c1"># 3     apple</span>
<span class="c1"># 4     apple</span>
<span class="c1"># 5    orange</span>
<span class="c1"># 6     apple</span>
<span class="c1"># 7     apple</span>
<span class="c1"># dtype: object</span>

<span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="c1"># Out[201]: array([&#39;apple&#39;, &#39;orange&#39;], dtype=object)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="c1"># Out[202]:</span>
<span class="c1"># apple     6</span>
<span class="c1"># orange    2</span>
<span class="c1"># Name: count, dtype: int64</span>
</pre></div>
</div>
</div>
</div>
<p>Nhiều hệ thống dữ liệu đã phát triển các phương pháp chuyên biệt để biểu diễn dữ liệu với các giá trị lặp lại nhằm lưu trữ và tính toán hiệu quả hơn. Một trong những phương pháp phổ biến là sử dụng các <em>dimension tables</em> chứa các giá trị riêng biệt và lưu trữ các quan sát chính dưới dạng các số nguyên tham chiếu đến bảng chiều:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">dim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">])</span>
<span class="n">values</span>
<span class="c1"># Out[205]:</span>
<span class="c1"># 0    0</span>
<span class="c1"># 1    1</span>
<span class="c1"># 2    0</span>
<span class="c1"># 3    0</span>
<span class="c1"># 4    0</span>
<span class="c1"># 5    1</span>
<span class="c1"># 6    0</span>
<span class="c1"># 7    0</span>
<span class="c1"># dtype: int64</span>

<span class="n">dim</span>
<span class="c1"># Out[206]:</span>
<span class="c1"># 0     apple</span>
<span class="c1"># 1    orange</span>
<span class="c1"># dtype: object</span>
</pre></div>
</div>
</div>
</div>
<p>Chúng ta có thể sử dụng phương thức <code class="docutils literal notranslate"><span class="pre">take</span></code> để khôi phục lại mảng ban đầu:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dim</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
<span class="c1"># Out[207]:</span>
<span class="c1"># 0     apple</span>
<span class="c1"># 1    orange</span>
<span class="c1"># 0     apple</span>
<span class="c1"># 0     apple</span>
<span class="c1"># 0     apple</span>
<span class="c1"># 1    orange</span>
<span class="c1"># 0     apple</span>
<span class="c1"># 0     apple</span>
<span class="c1"># dtype: object</span>
</pre></div>
</div>
</div>
</div>
<p>Biểu diễn này dưới dạng số nguyên được gọi là biểu diễn <em>phân loại</em> hoặc <em>mã hóa từ điển (dictionary-encoded)</em>. Mảng các giá trị riêng biệt có thể được gọi là các <em>phân loại (categories)</em>, <em>từ điển (dictionary)</em>, hoặc <em>cấp độ (levels)</em> của dữ liệu. Trong cuốn sách này, chúng ta sẽ sử dụng các thuật ngữ <em>phân loại (categories)</em>. Các giá trị số nguyên tham chiếu đến các category được gọi là <em>mã phân loại (category codes)</em>.</p>
<p>Biểu diễn phân loại có thể mang lại những cải thiện đáng kể về hiệu suất khi bạn thực hiện phân tích. Bạn cũng có thể thực hiện các phép biến đổi trên các phân loại trong khi vẫn giữ nguyên các câu lệnh. Một số ví dụ về các phép biến đổi có thể được thực hiện với chi phí tương đối thấp là:</p>
<ul class="simple">
<li><p>Đổi tên các phân loại</p></li>
<li><p>Thêm một phân loại mới mà không thay đổi thứ tự hoặc vị trí của các phân loại hiện có</p></li>
</ul>
</section>
<section id="kieu-phan-loai-trong-pandas">
<h3><span class="section-number">8.4.2. </span>Kiểu phân loại trong pandas<a class="headerlink" href="#kieu-phan-loai-trong-pandas" title="Link to this heading">#</a></h3>
<p>pandas có một kiểu mở rộng <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> đặc biệt để lưu trữ dữ liệu sử dụng biểu diễn hoặc mã hóa phân loại dựa trên số nguyên. Đây là một kỹ thuật nén dữ liệu phổ biến cho dữ liệu có nhiều lần xuất hiện của các giá trị tương tự và có thể cung cấp hiệu suất nhanh hơn đáng kể với việc sử dụng bộ nhớ thấp hơn, đặc biệt đối với dữ liệu chuỗi.</p>
<p>Hãy xem xét ví dụ Series từ trước:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;apple&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fruits</span><span class="p">)</span>
<span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;fruit&#39;</span><span class="p">:</span> <span class="n">fruits</span><span class="p">,</span>
                   <span class="s1">&#39;basket_id&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span>
                   <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">rng</span><span class="o">.</span><span class="n">integers</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">),</span>
                   <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">rng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)},</span>
                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;basket_id&#39;</span><span class="p">,</span> <span class="s1">&#39;fruit&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;weight&#39;</span><span class="p">])</span>
<span class="n">df</span>
<span class="c1"># Out[212]:</span>
<span class="c1">#    basket_id   fruit  count    weight</span>
<span class="c1"># 0          0   apple     11  1.564438</span>
<span class="c1"># 1          1  orange      5  1.331256</span>
<span class="c1"># 2          2   apple     12  2.393235</span>
<span class="c1"># 3          3   apple      6  0.746937</span>
<span class="c1"># 4          4   apple      5  2.691024</span>
<span class="c1"># 5          5  orange     12  3.767211</span>
<span class="c1"># 6          6   apple     10  0.992983</span>
<span class="c1"># 7          7   apple     11  3.795525</span>
</pre></div>
</div>
</div>
</div>
<p>Ở đây, <code class="docutils literal notranslate"><span class="pre">df['fruit']</span></code> là một mảng các đối tượng chuỗi ký tự của Python. Chúng ta có thể chuyển đổi nó thành phân loại bằng cách gọi:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fruit_cat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fruit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">fruit_cat</span>
<span class="c1"># Out[214]:</span>
<span class="c1"># 0     apple</span>
<span class="c1"># 1    orange</span>
<span class="c1"># 2     apple</span>
<span class="c1"># 3     apple</span>
<span class="c1"># 4     apple</span>
<span class="c1"># 5    orange</span>
<span class="c1"># 6     apple</span>
<span class="c1"># 7     apple</span>
<span class="c1"># Name: fruit, dtype: category</span>
<span class="c1"># Categories (2, object): [&#39;apple&#39;, &#39;orange&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Các giá trị cho <code class="docutils literal notranslate"><span class="pre">fruit_cat</span></code> bây giờ là một <code class="docutils literal notranslate"><span class="pre">pandas.Categorical</span></code> và có thể truy cập thông qua thuộc tính <code class="docutils literal notranslate"><span class="pre">.array</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">fruit_cat</span><span class="o">.</span><span class="n">array</span>
<span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="c1"># Out[216]: pandas.core.arrays.categorical.Categorical</span>
</pre></div>
</div>
</div>
</div>
<p>Đối tượng <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> có các thuộc tính <code class="docutils literal notranslate"><span class="pre">categories</span></code> và <code class="docutils literal notranslate"><span class="pre">codes</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">categories</span>
<span class="c1"># Out[217]: Index([&#39;apple&#39;, &#39;orange&#39;], dtype=&#39;object&#39;)</span>

<span class="n">c</span><span class="o">.</span><span class="n">codes</span>
<span class="c1"># Out[218]: array([0, 1, 0, 0, 0, 1, 0, 0], dtype=int8)</span>
</pre></div>
</div>
</div>
</div>
<p>Một cách để lấy ánh xạ giữa mã phân loại và giá trị là:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">categories</span><span class="p">))</span>
<span class="c1"># Out[219]: {0: &#39;apple&#39;, 1: &#39;orange&#39;}</span>
</pre></div>
</div>
</div>
</div>
<p>Bạn có thể chuyển đổi một cột DataFrame thành phân loại bằng cách gán kết quả đã chuyển đổi:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fruit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fruit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;fruit&quot;</span><span class="p">]</span>
<span class="c1"># Out[221]:</span>
<span class="c1"># 0     apple</span>
<span class="c1"># 1    orange</span>
<span class="c1"># 2     apple</span>
<span class="c1"># 3     apple</span>
<span class="c1"># 4     apple</span>
<span class="c1"># 5    orange</span>
<span class="c1"># 6     apple</span>
<span class="c1"># 7     apple</span>
<span class="c1"># Name: fruit, dtype: category</span>
<span class="c1"># Categories (2, object): [&#39;apple&#39;, &#39;orange&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Bạn cũng có thể tạo <code class="docutils literal notranslate"><span class="pre">pandas.Categorical</span></code> trực tiếp từ các loại chuỗi Python khác:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_categories</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
<span class="n">my_categories</span>
<span class="c1"># Out[223]:</span>
<span class="c1"># [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;foo&#39;, &#39;bar&#39;]</span>
<span class="c1"># Categories (3, object): [&#39;bar&#39;, &#39;baz&#39;, &#39;foo&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Nếu bạn đã thu được dữ liệu được mã hóa phân loại từ một nguồn khác, bạn có thể sử dụng hàm tạo <code class="docutils literal notranslate"><span class="pre">from_codes</span></code> thay thế:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">]</span>
<span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">my_cats_2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="o">.</span><span class="n">from_codes</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">categories</span><span class="p">)</span>
<span class="n">my_cats_2</span>
<span class="c1"># Out[227]:</span>
<span class="c1"># [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;foo&#39;, &#39;foo&#39;, &#39;bar&#39;]</span>
<span class="c1"># Categories (3, object): [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Trừ khi được chỉ định rõ ràng, các chuyển đổi phân loại giả định không có thứ tự cụ thể của các phân loại. Vì vậy, mảng các phân loại có thể theo một thứ tự khác nhau tùy thuộc vào thứ tự của dữ liệu đầu vào. Khi sử dụng <code class="docutils literal notranslate"><span class="pre">from_codes</span></code> hoặc bất kỳ hàm tạo nào khác, bạn có thể chỉ ra rằng các phân loại có một thứ tự có ý nghĩa:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ordered_cat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="o">.</span><span class="n">from_codes</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">categories</span><span class="p">,</span>
                                         <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ordered_cat</span>
<span class="c1"># Out[229]:</span>
<span class="c1"># [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;foo&#39;, &#39;foo&#39;, &#39;bar&#39;]</span>
<span class="c1"># Categories (3, object): [&#39;foo&#39; &lt; &#39;bar&#39; &lt; &#39;baz&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Đầu ra <code class="docutils literal notranslate"><span class="pre">[foo</span> <span class="pre">&lt;</span> <span class="pre">bar</span> <span class="pre">&lt;</span> <span class="pre">baz]</span></code> cho biết ‘foo’ đứng trước ‘bar’ trong thứ tự, v.v. Một thể hiện phân loại không có thứ tự có thể được sắp xếp thứ tự bằng <code class="docutils literal notranslate"><span class="pre">as_ordered</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_cats_2</span><span class="o">.</span><span class="n">as_ordered</span><span class="p">()</span>
<span class="c1"># Out[230]:</span>
<span class="c1"># [&#39;foo&#39;, &#39;bar&#39;, &#39;baz&#39;, &#39;foo&#39;, &#39;foo&#39;, &#39;bar&#39;]</span>
<span class="c1"># Categories (3, object): [&#39;foo&#39; &lt; &#39;bar&#39; &lt; &#39;baz&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Lưu ý cuối cùng, dữ liệu phân loại không nhất thiết phải là chuỗi, mặc dù chúng ta chỉ hiển thị các ví dụ về chuỗi. Một mảng phân loại có thể bao gồm bất kỳ kiểu giá trị bất biến nào.</p>
</section>
<section id="tinh-toan-voi-du-lieu-phan-loai">
<h3><span class="section-number">8.4.3. </span>Tính toán với dữ liệu phân loại<a class="headerlink" href="#tinh-toan-voi-du-lieu-phan-loai" title="Link to this heading">#</a></h3>
<p>Việc sử dụng <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> trong pandas so với phiên bản không mã hóa như một mảng các chuỗi thường hoạt động theo cùng một cách. Một số phần của <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, như hàm <code class="docutils literal notranslate"><span class="pre">groupby</span></code>, hoạt động tốt hơn khi làm việc với dữ liệu phân loại. Cũng có một số hàm có thể sử dụng <code class="docutils literal notranslate"><span class="pre">ordered</span></code>.</p>
<p>Hãy xem xét một số dữ liệu số ngẫu nhiên và sử dụng hàm phân nhóm <code class="docutils literal notranslate"><span class="pre">pandas.qcut</span></code>. Hàm này trả về <code class="docutils literal notranslate"><span class="pre">pandas.Categorical</span></code>; chúng ta đã sử dụng <code class="docutils literal notranslate"><span class="pre">pandas.cut</span></code> trước đó trong sách nhưng đã bỏ qua chi tiết về cách hoạt động của dữ liệu phân loại:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">draws</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">draws</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
<span class="c1"># Out[233]: array([-1.4238,  1.2637, -0.8707, -0.2592, -0.0753])</span>
</pre></div>
</div>
</div>
</div>
<p>Hãy tính toán một phân nhóm tứ phân vị của dữ liệu này và trích xuất một số thống kê:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">draws</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">bins</span>
<span class="c1"># Out[235]:</span>
<span class="c1"># [(-3.121, -0.675], (0.687, 3.211], (-3.121, -0.675], (-0.675, 0.0134], (-0.675, 0.0134], ...,</span>
<span class="c1"># (0.0134, 0.687], (0.0134, 0.687], (-0.675, 0.0134], (0.0134, 0.687], (-0.675, 0.0134]]</span>
<span class="c1"># Length: 1000</span>
<span class="c1"># Categories (4, interval[float64, right]): [(-3.121, -0.675] &lt; (-0.675, 0.0134] &lt; (0.0134, 0.687] &lt; (0.687, 3.211]]</span>
</pre></div>
</div>
</div>
</div>
<p>Mặc dù hữu ích, các phân vị mẫu chính xác có thể ít hữu ích hơn để tạo báo cáo so với tên tứ phân vị. Chúng ta có thể đạt được điều này bằng đối số <code class="docutils literal notranslate"><span class="pre">labels</span></code> cho <code class="docutils literal notranslate"><span class="pre">qcut</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">draws</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Q1&#39;</span><span class="p">,</span> <span class="s1">&#39;Q2&#39;</span><span class="p">,</span> <span class="s1">&#39;Q3&#39;</span><span class="p">,</span> <span class="s1">&#39;Q4&#39;</span><span class="p">])</span>
<span class="n">bins</span>
<span class="c1"># Out[237]:</span>
<span class="c1"># [&#39;Q1&#39;, &#39;Q4&#39;, &#39;Q1&#39;, &#39;Q2&#39;, &#39;Q2&#39;, ..., &#39;Q3&#39;, &#39;Q3&#39;, &#39;Q2&#39;, &#39;Q3&#39;, &#39;Q2&#39;]</span>
<span class="c1"># Length: 1000</span>
<span class="c1"># Categories (4, object): [&#39;Q1&#39; &lt; &#39;Q2&#39; &lt; &#39;Q3&#39; &lt; &#39;Q4&#39;]</span>

<span class="n">bins</span><span class="o">.</span><span class="n">codes</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="c1"># Out[238]: array([0, 3, 0, 1, 1, 0, 0, 2, 2, 0], dtype=int8)</span>
</pre></div>
</div>
</div>
</div>
<p>Dữ liệu phân loại <code class="docutils literal notranslate"><span class="pre">bins</span></code> được gắn nhãn không chứa thông tin về các cạnh nhóm trong dữ liệu, vì vậy chúng ta có thể sử dụng <code class="docutils literal notranslate"><span class="pre">groupby</span></code> để trích xuất một số thống kê tóm tắt:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;quartile&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">draws</span><span class="p">)</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span>
             <span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">])</span>
             <span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
<span class="n">results</span>
<span class="c1"># Out[241]:</span>
<span class="c1">#   quartile  count       min       max</span>
<span class="c1"># 0       Q1    250 -3.119609 -0.678494</span>
<span class="c1"># 1       Q2    250 -0.673305  0.008009</span>
<span class="c1"># 2       Q3    250  0.018753  0.686183</span>
<span class="c1"># 3       Q4    250  0.688282  3.211418</span>
</pre></div>
</div>
</div>
</div>
<p>Cột <code class="docutils literal notranslate"><span class="pre">'quartile'</span></code> trong kết quả giữ lại thông tin phân loại ban đầu, bao gồm cả thứ tự, từ <code class="docutils literal notranslate"><span class="pre">bins</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;quartile&#39;</span><span class="p">]</span>
<span class="c1"># Out[242]:</span>
<span class="c1"># 0    Q1</span>
<span class="c1"># 1    Q2</span>
<span class="c1"># 2    Q3</span>
<span class="c1"># 3    Q4</span>
<span class="c1"># Name: quartile, dtype: category</span>
<span class="c1"># Categories (4, object): [&#39;Q1&#39; &lt; &#39;Q2&#39; &lt; &#39;Q3&#39; &lt; &#39;Q4&#39;]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="do-luong-hieu-suat-khi-su-dung-du-lieu-phan-loai">
<h3><span class="section-number">8.4.4. </span>Đo lường hiệu suất khi sử dụng dữ liệu phân loại<a class="headerlink" href="#do-luong-hieu-suat-khi-su-dung-du-lieu-phan-loai" title="Link to this heading">#</a></h3>
<p>Ở phần trước, chúng ta đã nói rằng các kiểu phân loại có thể cải thiện hiệu suất và việc sử dụng bộ nhớ, vì vậy hãy xem một số ví dụ. Hãy xem xét một số Series với 10 triệu phần tử và một số lượng nhỏ các phân loại riêng biệt:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10_000_000</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;qux&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Bây giờ chúng ta chuyển đổi <code class="docutils literal notranslate"><span class="pre">labels</span></code> thành phân loại:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">categories</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Bây giờ chúng ta lưu ý rằng <code class="docutils literal notranslate"><span class="pre">labels</span></code> sử dụng bộ nhớ nhiều hơn đáng kể so với <code class="docutils literal notranslate"><span class="pre">categories</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Out[246]: 600000128</span>

<span class="n">categories</span><span class="o">.</span><span class="n">memory_usage</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Out[247]: 10000540</span>
</pre></div>
</div>
</div>
</div>
<p>Tất nhiên, việc chuyển đổi sang <code class="docutils literal notranslate"><span class="pre">category</span></code> cũng sẽ cần thời gian tính toán, nhưng đó là tính toán một lần:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">time</span> _ = labels.astype(&#39;category&#39;)
<span class="c1"># CPU times: user 279 ms, sys: 6.06 ms, total: 285 ms</span>
<span class="c1"># Wall time: 285 ms</span>
</pre></div>
</div>
</div>
</div>
<p>Các thao tác <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code> có thể nhanh hơn đáng kể với dữ liệu phân loại vì các thuật toán cơ bản sử dụng mảng mã dựa trên số nguyên thay vì một mảng các chuỗi. Ở đây chúng ta so sánh hiệu suất của <code class="docutils literal notranslate"><span class="pre">value_counts()</span></code>, mà bên trong sử dụng cơ chế <code class="docutils literal notranslate"><span class="pre">GroupBy</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">timeit</span> labels.value_counts()
<span class="c1"># 331 ms +- 5.39 ms per loop (mean +- std. dev. of 7 runs, 1 loop each)</span>

<span class="o">%</span><span class="k">timeit</span> categories.value_counts()
<span class="c1"># 15.6 ms +- 152 us per loop (mean +- std. dev. of 7 runs, 100 loops each)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="phuong-thuc-phan-loai">
<h3><span class="section-number">8.4.5. </span>Phương thức phân loại<a class="headerlink" href="#phuong-thuc-phan-loai" title="Link to this heading">#</a></h3>
<p>Series chứa dữ liệu phân loại có một số phương thức đặc biệt tương tự như các phương thức chuỗi chuyên biệt <code class="docutils literal notranslate"><span class="pre">Series.str</span></code>. Điều này cũng cung cấp quyền truy cập thuận tiện vào các phân loại và mã. Hãy xem xét Series:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">cat_s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
<span class="n">cat_s</span>
<span class="c1"># Out[253]:</span>
<span class="c1"># 0    a</span>
<span class="c1"># 1    b</span>
<span class="c1"># 2    c</span>
<span class="c1"># 3    d</span>
<span class="c1"># 4    a</span>
<span class="c1"># 5    b</span>
<span class="c1"># 6    c</span>
<span class="c1"># 7    d</span>
<span class="c1"># dtype: category</span>
<span class="c1"># Categories (4, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Thuộc tính truy cập đặc biệt <code class="docutils literal notranslate"><span class="pre">cat</span></code> cung cấp quyền truy cập vào các phương thức phân loại:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
<span class="c1"># Out[254]:</span>
<span class="c1"># 0    0</span>
<span class="c1"># 1    1</span>
<span class="c1"># 2    2</span>
<span class="c1"># 3    3</span>
<span class="c1"># 4    0</span>
<span class="c1"># 5    1</span>
<span class="c1"># 6    2</span>
<span class="c1"># 7    3</span>
<span class="c1"># dtype: int8</span>

<span class="n">cat_s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
<span class="c1"># Out[255]: Index([&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;], dtype=&#39;object&#39;)</span>
</pre></div>
</div>
</div>
</div>
<p>Giả sử rằng chúng ta biết tập hợp các phân loại thực tế cho dữ liệu này mở rộng ra ngoài bốn giá trị được quan sát trong dữ liệu. Chúng ta có thể sử dụng phương thức <code class="docutils literal notranslate"><span class="pre">set_categories</span></code> để thay đổi chúng:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">actual_categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]</span>
<span class="n">cat_s2</span> <span class="o">=</span> <span class="n">cat_s</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">set_categories</span><span class="p">(</span><span class="n">actual_categories</span><span class="p">)</span>
<span class="n">cat_s2</span>
<span class="c1"># Out[258]:</span>
<span class="c1"># 0    a</span>
<span class="c1"># 1    b</span>
<span class="c1"># 2    c</span>
<span class="c1"># 3    d</span>
<span class="c1"># 4    a</span>
<span class="c1"># 5    b</span>
<span class="c1"># 6    c</span>
<span class="c1"># 7    d</span>
<span class="c1"># dtype: category</span>
<span class="c1"># Categories (5, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Mặc dù có vẻ như dữ liệu không thay đổi, các phân loại mới sẽ được phản ánh trong các hoạt động sử dụng chúng. Ví dụ, <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> giữ nguyên các phân loại, nếu có:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_s</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="c1"># Out[259]:</span>
<span class="c1"># a    2</span>
<span class="c1"># b    2</span>
<span class="c1"># c    2</span>
<span class="c1"># d    2</span>
<span class="c1"># Name: count, dtype: int64</span>

<span class="n">cat_s2</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="c1"># Out[260]:</span>
<span class="c1"># a    2</span>
<span class="c1"># b    2</span>
<span class="c1"># c    2</span>
<span class="c1"># d    2</span>
<span class="c1"># e    0</span>
<span class="c1"># Name: count, dtype: int64</span>
</pre></div>
</div>
</div>
</div>
<p>Trong các tập dữ liệu lớn, dữ liệu phân loại thường được sử dụng như một công cụ tiện lợi để tiết kiệm bộ nhớ và cải thiện hiệu suất. Sau khi bạn lọc một DataFrame hoặc Series lớn, nhiều phân loại có thể không xuất hiện trong dữ liệu. Để giải quyết vấn đề này, chúng ta có thể sử dụng phương thức <code class="docutils literal notranslate"><span class="pre">remove_unused_categories</span></code> để loại bỏ các phân loại không được quan sát:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_s3</span> <span class="o">=</span> <span class="n">cat_s</span><span class="p">[</span><span class="n">cat_s</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])]</span>
<span class="n">cat_s3</span>
<span class="c1"># Out[262]:</span>
<span class="c1"># 0    a</span>
<span class="c1"># 1    b</span>
<span class="c1"># 4    a</span>
<span class="c1"># 5    b</span>
<span class="c1"># dtype: category</span>
<span class="c1"># Categories (4, object): [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>

<span class="n">cat_s3</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">remove_unused_categories</span><span class="p">()</span>
<span class="c1"># Out[263]:</span>
<span class="c1"># 0    a</span>
<span class="c1"># 1    b</span>
<span class="c1"># 4    a</span>
<span class="c1"># 5    b</span>
<span class="c1"># dtype: category</span>
<span class="c1"># Categories (2, object): [&#39;a&#39;, &#39;b&#39;]</span>
</pre></div>
</div>
</div>
</div>
<p>Xem Bảng … để biết danh sách các phương thức phân loại có sẵn.</p>
<p><strong>Bảng …: Các phương thức phân loại cho Series trong pandas</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Phương thức</p></th>
<th class="head"><p>Mô tả</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">add_categories</span></code></p></td>
<td><p>Thêm các phân loại mới (chưa sử dụng) vào cuối các phân loại hiện có.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">as_ordered</span></code></p></td>
<td><p>Làm cho các phân loại có thứ tự.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">as_unordered</span></code></p></td>
<td><p>Làm cho các phân loại không có thứ tự.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">remove_categories</span></code></p></td>
<td><p>Loại bỏ các phân loại, đặt bất kỳ giá trị bị loại bỏ nào thành null.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">remove_unused_categories</span></code></p></td>
<td><p>Loại bỏ bất kỳ giá trị phân loại nào không xuất hiện trong dữ liệu.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">rename_categories</span></code></p></td>
<td><p>Thay thế các phân loại bằng tập hợp các tên phân loại mới được chỉ định; không thể thay đổi số lượng phân loại.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">reorder_categories</span></code></p></td>
<td><p>Hoạt động giống như <code class="docutils literal notranslate"><span class="pre">rename_categories</span></code>, nhưng cũng có thể thay đổi kết quả để có các phân loại có thứ tự.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">set_categories</span></code></p></td>
<td><p>Thay thế các phân loại bằng tập hợp các phân loại mới được chỉ định; có thể thêm hoặc loại bỏ các phân loại.</p></td>
</tr>
</tbody>
</table>
</div>
<section id="tao-bien-gia-de-lap-mo-hinh">
<h4><span class="section-number">8.4.5.1. </span>Tạo biến giả để lập mô hình<a class="headerlink" href="#tao-bien-gia-de-lap-mo-hinh" title="Link to this heading">#</a></h4>
<p>Khi bạn sử dụng các công cụ thống kê hoặc học máy, bạn sẽ thường xuyên chuyển đổi dữ liệu phân loại thành các <em>biến giả (dummy variables)</em>, còn được gọi là <em>mã hóa one-hot (one-hot encoding)</em>. Điều này liên quan đến việc tạo một DataFrame với một cột cho mỗi phân loại riêng biệt; các cột này chứa 1 cho các lần xuất hiện của một phân loại nhất định và 0 cho các trường hợp khác.</p>
<p>Hãy xem xét ví dụ trước:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_s</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Như đã đề cập trước đó trong chương này, hàm <code class="docutils literal notranslate"><span class="pre">pandas.get_dummies</span></code> chuyển đổi dữ liệu phân loại một chiều này thành một DataFrame chứa biến giả:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">cat_s</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="c1"># Out[265]:</span>
<span class="c1">#      a    b    c    d</span>
<span class="c1"># 0  1.0  0.0  0.0  0.0</span>
<span class="c1"># 1  0.0  1.0  0.0  0.0</span>
<span class="c1"># 2  0.0  0.0  1.0  0.0</span>
<span class="c1"># 3  0.0  0.0  0.0  1.0</span>
<span class="c1"># 4  1.0  0.0  0.0  0.0</span>
<span class="c1"># 5  0.0  1.0  0.0  0.0</span>
<span class="c1"># 6  0.0  0.0  1.0  0.0</span>
<span class="c1"># 7  0.0  0.0  0.0  1.0</span>
</pre></div>
</div>
</div>
</div>
<p>Như vậy, bạn đọc có thể thấy rằng việc chuẩn bị dữ liệu hiệu quả có thể cải thiện đáng kể năng suất bằng cách cho phép bạn dành nhiều thời gian hơn để phân tích dữ liệu và ít thời gian hơn để chuẩn bị dữ liệu cho phân tích. Chúng ta đã khám phá một số công cụ trong chương này, nhưng phạm vi bao phủ ở đây không hề toàn diện. Trong chương tiếp theo, chúng ta sẽ khám phá chức năng thêm các chức năng quan trọng khác của <code class="docutils literal notranslate"><span class="pre">pandas</span></code> trong phân tích dữ liệu.</p>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapters"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="chapter7-Import-data.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Nhập và lưu trữ dữ liệu</p>
      </div>
    </a>
    <a class="right-next"
       href="chapter9-transform.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>Sắp xếp và biến đổi dữ liệu</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#xu-ly-du-lieu-khong-quan-sat-duoc">8.1. Xử lý dữ liệu không quan sát được</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loc-bo-du-lieu-bi-thieu">8.1.1. Lọc bỏ dữ liệu bị thiếu</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dien-vao-du-lieu-bi-thieu">8.1.2. Điền vào dữ liệu bị thiếu</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#chuyen-doi-du-lieu">8.2. Chuyển đổi Dữ Liệu</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loai-bo-cac-gia-tri-trung-lap">8.2.1. Loại bỏ các giá trị trùng lặp</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#chuyen-doi-du-lieu-bang-ham-hoac-mapping">8.2.2. Chuyển đổi dữ liệu bằng hàm hoặc mapping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#thay-the-cac-gia-tri">8.2.3. Thay thế các giá trị</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#doi-ten-chi-so-hang-va-cot">8.2.4. Đổi tên chỉ số hàng và cột</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#roi-rac-hoa-va-phan-nhom">8.2.5. Rời rạc hóa và phân nhóm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phat-hien-va-xu-ly-cac-gia-tri-ngoai-lai">8.2.6. Phát hiện và xử lý các giá trị ngoại lai</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tinh-toan-bien-chi-bao">8.2.7. Tính toán biến chỉ báo</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#thao-tac-tren-chuoi-ky-tu">8.3. Thao tác trên chuỗi ký tự</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cac-phuong-thuc-doi-tuong-chuoi-ky-tu-tich-hop-san-cua-python">8.3.1. Các phương thức đối tượng chuỗi ký tự tích hợp sẵn của Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bieu-thuc-chinh-quy">8.3.2. Biểu thức chính quy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#du-lieu-kieu-phan-loai">8.4. Dữ liệu kiểu phân loại</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#du-lieu-kieu-phan-loai-la-gi">8.4.1. Dữ liệu kiểu phân loại là gì?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kieu-phan-loai-trong-pandas">8.4.2. Kiểu phân loại trong pandas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tinh-toan-voi-du-lieu-phan-loai">8.4.3. Tính toán với dữ liệu phân loại</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#do-luong-hieu-suat-khi-su-dung-du-lieu-phan-loai">8.4.4. Đo lường hiệu suất khi sử dụng dữ liệu phân loại</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#phuong-thuc-phan-loai">8.4.5. Phương thức phân loại</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#tao-bien-gia-de-lap-mo-hinh">8.4.5.1. Tạo biến giả để lập mô hình</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <div style="text-align: left; padding: 1em; font-size: 1em;">
  <p>© 2025 <a href="https://nct.neu.edu.vn" target="_blank" style="text-decoration: none;">Trường Công nghệ- NEU </a> </p>
  <p>Liên hệ: <a href="mailto:truongcongnghe@neu.edu.vn">truongcongnghe@neu.edu.vn</a></p>
</div>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>